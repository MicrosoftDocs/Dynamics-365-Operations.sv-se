---
title: Översikt över räkenskapsintegration för handelskanaler
description: Det här avsnittet innehåller en översikt över funktioner för räkenskapsintegration som är tillgängliga i Dynamics 365 Commerce.
author: josaw
manager: annbe
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 45677681ebae40210d6e2d896323f7e691b765e2
ms.sourcegitcommit: 12b9d6f2dd24e52e46487748c848864909af6967
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 02/14/2020
ms.locfileid: "3057566"
---
# <a name="overview-of-fiscal-integration-for-commerce-channels"></a><span data-ttu-id="77b14-103">Översikt över räkenskapsintegration för handelskanaler</span><span class="sxs-lookup"><span data-stu-id="77b14-103">Overview of fiscal integration for Commerce channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="77b14-104">Introduktion</span><span class="sxs-lookup"><span data-stu-id="77b14-104">Introduction</span></span>

<span data-ttu-id="77b14-105">Det här avsnittet innehåller en översikt över funktioner för räkenskapsintegration som är tillgängliga i Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="77b14-105">This topic is an overview of the fiscal integration capabilities that are available in Dynamics 365 Commerce.</span></span> <span data-ttu-id="77b14-106">Räkenskapsintegration omfattar integration med olika räkenskapsenheter och tjänster som underlättar för räkenskapsregistrering av försäljning i enlighet med lokala skattelagar som syftar till förhindrande av skattebedrägeri inom detaljhandel.</span><span class="sxs-lookup"><span data-stu-id="77b14-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="77b14-107">Typiska scenarier som kan omfatta räkenskapsintegration är:</span><span class="sxs-lookup"><span data-stu-id="77b14-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="77b14-108">Registrera en räkenskapsenhet som är ansluten till kassa (POS), till exempel en kvittoskrivare och skriva ut en kvittoskrivare för kunden.</span><span class="sxs-lookup"><span data-stu-id="77b14-108">Register a sale on a fiscal device that is connected to point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="77b14-109">Skicka säkert information som är relaterad till försäljning och returer som slutförs i Retail POS till en extern webbtjänst som drivs av skattemyndigheten.</span><span class="sxs-lookup"><span data-stu-id="77b14-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="77b14-110">Hjälpa till att garantera oföränderlighet av försäljningstransaktionsdata via digitala signaturer.</span><span class="sxs-lookup"><span data-stu-id="77b14-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="77b14-111">Räkenskapsintegreringen är ett ramverk som utgör en gemensam lösning för ytterligare utveckling och anpassning av integration mellan Retail POS och räkenskapsenheter och tjänster.</span><span class="sxs-lookup"><span data-stu-id="77b14-111">The fiscal integration functionality is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="77b14-112">Funktionen innehåller också exempel på räkenskapsintegration som stöder grundläggande scenarier för vissa länder eller regioner, och som arbetar med specifika räkenskapsenheter och tjänster.</span><span class="sxs-lookup"><span data-stu-id="77b14-112">The functionality also includes fiscal integration samples that support basic scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="77b14-113">Exempel på räkenskapsintegration består av flera tillägg av Handel-komponenter och ingår i programutvecklingskit (SDK).</span><span class="sxs-lookup"><span data-stu-id="77b14-113">A fiscal integration sample consists of several extensions of Commerce components and is included in the software development kit (SDK).</span></span> <span data-ttu-id="77b14-114">Mer information om exempel på räkenskapsintegration finns i [Exempel på räkenskapsintegration i Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span><span class="sxs-lookup"><span data-stu-id="77b14-114">For more information about the fiscal integration samples, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="77b14-115">Information om hur du installerar och använder Retail SDK finns i [Retail programutvecklingskit (SDK) arkitektur](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span><span class="sxs-lookup"><span data-stu-id="77b14-115">For information about how to install and use the Retail SDK, see [Retail software development kit (SDK) architecture](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="77b14-116">Stöd för andra scenarier som inte stöds av exempel på räkenskapsintegration, för att integrera Retail POS med andra räkenskapsprodukter eller tjänster och täcka kraven i andra länder eller regioner, måste du utöka ett befintligt exempel på räkenskapsintegration eller skapa ett nytt prov med ett befintligt prov som exempel.</span><span class="sxs-lookup"><span data-stu-id="77b14-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="77b14-117">Process för räkenskapsregistrering och exempel på räkenskapsintegration för räkenskapsenheter</span><span class="sxs-lookup"><span data-stu-id="77b14-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="77b14-118">En process för räkenskapsregistrering i Retail POS kan bestå av ett eller flera steg.</span><span class="sxs-lookup"><span data-stu-id="77b14-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="77b14-119">Varje steg omfattar räkenskapsregistrering av specifika transaktioner och händelser i en räkenskapsenhet eller tjänst.</span><span class="sxs-lookup"><span data-stu-id="77b14-119">Each step involves fiscal registration of specific transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="77b14-120">Följande komponenter ingår i räkenskapsregistrering i en räkenskapsenhet som är ansluten till en maskinvarustation:</span><span class="sxs-lookup"><span data-stu-id="77b14-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="77b14-121">**Tillägget Commerce Runtime (CRT)** - den här komponenten serialiserar transaktionshändelsen/data i det format som också används i samband med räkenskapsårets analyserar svaren från räkenskapsenhet och lagrar svaren i kanaldatabasen.</span><span class="sxs-lookup"><span data-stu-id="77b14-121">**Commerce runtime (CRT) extension** – This component serializes transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="77b14-122">Tillägget definierar även specifika transaktioner och händelser som ska registreras.</span><span class="sxs-lookup"><span data-stu-id="77b14-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="77b14-123">Den här komponenten kalla ofta en *leverantör av skattedokument*.</span><span class="sxs-lookup"><span data-stu-id="77b14-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="77b14-124">**Tillägg för maskinvarustation** – denna komponent initierar kommunikationen med räkenskapsenheten, skickar begärande och kommandon direkt till räkenskapsenheten baserat på transaktionshändelse/data som extraheras från skattedokument och tar emot svar från räkenskapsenheten.</span><span class="sxs-lookup"><span data-stu-id="77b14-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="77b14-125">Den här komponenten kalla ofta en *räkenskapskoppling*.</span><span class="sxs-lookup"><span data-stu-id="77b14-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="77b14-126">Ett exempel på räkenskapsintegration för räkenskapsenheter innehåller respektive tillägg för CRT och maskinvarustation för en leverantör av skattedokument och en räkenskapskoppling</span><span class="sxs-lookup"><span data-stu-id="77b14-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="77b14-127">Den innehåller även följande komponentkonfigurationer:</span><span class="sxs-lookup"><span data-stu-id="77b14-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="77b14-128">**Konfiguration av leverantör av skattedokument** – den här konfigurationen definierar en utmatningsmetod och ett format för skattedokument.</span><span class="sxs-lookup"><span data-stu-id="77b14-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="77b14-129">Den innehåller även en datamappning för skatter och betalningsmetoder som gör data från Retail POS kompatibel med de värden som ska fördefinieras i räkenskapsenhetens inbyggda programvara.</span><span class="sxs-lookup"><span data-stu-id="77b14-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="77b14-130">**Konfiguration av räkenskapskopplare** – definierar den fysiska kommunikationen med räkenskapsenheten.</span><span class="sxs-lookup"><span data-stu-id="77b14-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="77b14-131">En process för räkenskapsregistrering för ett visst kassaregister definieras av en motsvarande inställning i kassans funktionsprofil.</span><span class="sxs-lookup"><span data-stu-id="77b14-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="77b14-132">Mer information om hur du konfigurerar processen för räkenskapsregistrering, laddar upp konfiguration av leverantör av skattedokument och räkenskapskopplare och ändra deras parametrar finns i [skapa en process för räkenskapsregistrering](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span><span class="sxs-lookup"><span data-stu-id="77b14-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="77b14-133">I följande exempel visas en typisk flöde för räkenskapsregistreringskörning för räkenskapsenheter.</span><span class="sxs-lookup"><span data-stu-id="77b14-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="77b14-134">Flödet börjar med en händelse i kassan (exempelvis slutförandet av en försäljningstransaktion) och implementerar följande sekvens med steg:</span><span class="sxs-lookup"><span data-stu-id="77b14-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="77b14-135">Kassan begär ett skattedokumentet från CRT.</span><span class="sxs-lookup"><span data-stu-id="77b14-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="77b14-136">CRT avgör om händelsen kräver räkenskapsregistrering.</span><span class="sxs-lookup"><span data-stu-id="77b14-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="77b14-137">Baserat på processen för räkenskapsregistrering identifierar CRT en skattekoppling och motsvarande leverantör av skattedokument för räkenskapsregistreringen.</span><span class="sxs-lookup"><span data-stu-id="77b14-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="77b14-138">CRT kör leverantören av skattedokument som genererar skattedokument (till exempel ett XML-dokument) som motsvarar transaktionen eller händelse.</span><span class="sxs-lookup"><span data-stu-id="77b14-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the transaction or event.</span></span>
5. <span data-ttu-id="77b14-139">Kassan skickar skattedokumentet som CRT förbereder till en maskinvarustation.</span><span class="sxs-lookup"><span data-stu-id="77b14-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="77b14-140">Maskinvarustationen kör räkenskapskopplingen som bearbetar skattedokumentet och vidarebefordrar informationen till räkenskapsenheten eller tjänsten.</span><span class="sxs-lookup"><span data-stu-id="77b14-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="77b14-141">Kassan analyserar svaret från räkenskapsenheten eller tjänsten för att avgöra om räkenskapsregistreringen har lyckats.</span><span class="sxs-lookup"><span data-stu-id="77b14-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="77b14-142">CRT sparar svaret i kanaldatabasen.</span><span class="sxs-lookup"><span data-stu-id="77b14-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="77b14-143">![Lösningsschema](media/emea-fiscal-integration-solution.png "Lösningsschema")</span><span class="sxs-lookup"><span data-stu-id="77b14-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="77b14-144">Felhantering</span><span class="sxs-lookup"><span data-stu-id="77b14-144">Error handling</span></span>

<span data-ttu-id="77b14-145">Ramverket för räkenskapsintegration ger följande alternativ för att hantera misslyckanden under räkenskapsregistreringen:</span><span class="sxs-lookup"><span data-stu-id="77b14-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="77b14-146">**Försök igen** – Operatörer kan använda det här alternativet när felet kan lösas snabbt och räkenskapsregistreringen kan köras igen.</span><span class="sxs-lookup"><span data-stu-id="77b14-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="77b14-147">Det här alternativet kan till exempel användas när räkenskapsenheten inte är ansluten, kvittoskrivaren har slut på papper eller så finns det ett papper har fastnat i kvittoskrivaren.</span><span class="sxs-lookup"><span data-stu-id="77b14-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="77b14-148">**Avbryt** – inställningen låter operatörer senarelägga räkenskapsregistreringen av den aktuella transaktionen eller händelsen om det uppstår ett fel.</span><span class="sxs-lookup"><span data-stu-id="77b14-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="77b14-149">När registreringen senareläggs kan operatören fortsätta att arbeta med kassan kan utföra alla åtgärder som räkenskapsregistrering inte är obligatoriskt för</span><span class="sxs-lookup"><span data-stu-id="77b14-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="77b14-150">När en händelse som kräver räkenskapsregistrering sker i kassan (till exempel en ny transaktion öppnas), kommer dialogrutan för felhantering automatisk att visas för att meddela operatören att föregående transaktion inte registrerades korrekt och att ge alternativ för felhantering.</span><span class="sxs-lookup"><span data-stu-id="77b14-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="77b14-151">**Hoppa över** - operatörer kan använda det här alternativet när räkenskapsregistreringen kan utelämnas, under vissa förhållanden och vanliga operationer kan fortsätta i kassan.</span><span class="sxs-lookup"><span data-stu-id="77b14-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="77b14-152">Det här alternativet kan exempelvis användas när en försäljningstransaktion som räkenskapsregistreringen misslyckades för kan registreras i en speciell pappersjournal.</span><span class="sxs-lookup"><span data-stu-id="77b14-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="77b14-153">**Markera som registrerad** – operatörer kan använda detta alternativ när transaktionen faktiskt registrerades i räkenskapsenhet (exempelvis ett skattekvitto skrevs ut), men ett fel uppstod vid räkenskapssvaret sparades i kanaldatabasen.</span><span class="sxs-lookup"><span data-stu-id="77b14-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="77b14-154">Alternativen **Hoppa över** och **Markera som registrerad** måste vara aktiverade på processen för räkenskapsregistrering innan de används.</span><span class="sxs-lookup"><span data-stu-id="77b14-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="77b14-155">Dessutom måste motsvarande behörigheter tilldelas operatörer.</span><span class="sxs-lookup"><span data-stu-id="77b14-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="77b14-156">Alternativen **Hoppa över** och **Markera som registrerade** tillåter informationskoder att samla in viss information om felet, till exempel orsaken till felet eller en justering för att hoppa över räkenskapsregistreringen eller märka transaktionen som registrerad.</span><span class="sxs-lookup"><span data-stu-id="77b14-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="77b14-157">Mer information om hur du ställer in parametrar för felhantering finns i [ange inställningar för felhantering](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="77b14-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="77b14-158">Valfri skatteregistrering</span><span class="sxs-lookup"><span data-stu-id="77b14-158">Optional fiscal registration</span></span>

<span data-ttu-id="77b14-159">Räkenskapsregistrering kan vara obligatorisk för vissa åtgärder och valfri för andra.</span><span class="sxs-lookup"><span data-stu-id="77b14-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="77b14-160">Exempelvis kan räkenskapsregistrering av vanlig försäljning och returer kan vara obligatorisk men räkenskapsregistrering av åtgärder som är relaterade till kundinsättningar kan vara valfria.</span><span class="sxs-lookup"><span data-stu-id="77b14-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="77b14-161">I detta fall blockerar misslyckande att slutföra räkenskapsregistreringen av en försäljning ytterligare försäljning, men misslyckande att slutföra räkenskapsregistreringen av en kundinsättning bör inte blockera ytterligare försäljning.</span><span class="sxs-lookup"><span data-stu-id="77b14-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="77b14-162">Om du vill skilja mellan obligatoriska och frivilliga åtgärder, rekommenderas det att du hanterar dem via olika dokumentleverantörer och att du ställer in separata steg i räkenskapsregistreringsprocessen för leverantörerna.</span><span class="sxs-lookup"><span data-stu-id="77b14-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="77b14-163">Parametern **Fortsätt vid fel** ska aktiveras för varje steg som hör till valfri räkenskapsregistrering.</span><span class="sxs-lookup"><span data-stu-id="77b14-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="77b14-164">Mer information om hur du ställer in parametrar för felhantering finns i [ange inställningar för felhantering](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="77b14-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="77b14-165">Manuellt köra räkenskapsregistrering</span><span class="sxs-lookup"><span data-stu-id="77b14-165">Manually running fiscal registration</span></span>

<span data-ttu-id="77b14-166">Om räkenskapsregistrering av transaktioner eller händelser har skjutits upp efter ett fel (till exempel om operatören valde **Avbryt** i dialogrutan för felhantering), kan du manuellt köra räkenskapsregistreringen genom att åberopa en motsvarande åtgärd.</span><span class="sxs-lookup"><span data-stu-id="77b14-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="77b14-167">För mer information, se [Aktivera manuell körning av uppskjutna räkenskapsregistreringar](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span><span class="sxs-lookup"><span data-stu-id="77b14-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="77b14-168">Hälsokontroll av räkenskapsregistrering</span><span class="sxs-lookup"><span data-stu-id="77b14-168">Fiscal registration health check</span></span>

<span data-ttu-id="77b14-169">Hälsokontrollproceduren för räkenskapsregistreringar kontrollerar tillgängligheten för räkenskapsenheten eller tjänsten när specifika händelser inträffar.</span><span class="sxs-lookup"><span data-stu-id="77b14-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="77b14-170">Om räkenskapsregistreringen för tillfället inte kan slutföras meddelas operatorn i förväg.</span><span class="sxs-lookup"><span data-stu-id="77b14-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="77b14-171">Kassan kör hälsokontrollen när följande händelser inträffar:</span><span class="sxs-lookup"><span data-stu-id="77b14-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="77b14-172">En ny transaktion öppnas.</span><span class="sxs-lookup"><span data-stu-id="77b14-172">A new transaction is opened.</span></span>
- <span data-ttu-id="77b14-173">En uppskjuten transaktion återkallas.</span><span class="sxs-lookup"><span data-stu-id="77b14-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="77b14-174">En försäljnings- eller returtransaktion slutförs.</span><span class="sxs-lookup"><span data-stu-id="77b14-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="77b14-175">Om hälsokontrollen misslyckas visar kassan dialogrutan för hälsokontroll.</span><span class="sxs-lookup"><span data-stu-id="77b14-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="77b14-176">Den här dialogrutan innehåller följande knappar:</span><span class="sxs-lookup"><span data-stu-id="77b14-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="77b14-177">**OK** – med den här knappen kan operatorn ignorera ett hälsokontrollfel och fortsätta att utföra åtgärden.</span><span class="sxs-lookup"><span data-stu-id="77b14-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="77b14-178">Operatörer kan välja den här knappen om behörigheten **Tillåt hoppa över hälsofel** är aktiverad för dem.</span><span class="sxs-lookup"><span data-stu-id="77b14-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="77b14-179">**Avbryt** – om operatören väljer denna knapp, avbryter kassan den senaste åtgärden (till exempel en artikel läggs inte till en ny transaktion).</span><span class="sxs-lookup"><span data-stu-id="77b14-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="77b14-180">Hälsokontrollen körs endast om den aktuella åtgärden kräver räkenskapsregistrering och om parametern **Fortsätt vid fel** inaktiveras för det aktuella steget av räkenskapsregistreringsprocessen.</span><span class="sxs-lookup"><span data-stu-id="77b14-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="77b14-181">Mer information finns i [Ange inställningar för felhantering](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="77b14-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="77b14-182">Lagra räkenskapssvar i räkenskapstransaktion</span><span class="sxs-lookup"><span data-stu-id="77b14-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="77b14-183">Vid räkenskapsregistrering av transaktioner eller händelser lyckas, skapas en räkenskapstransaktion i kanaldatabasen och kopplas till den ursprungliga transaktionen eller händelsen.</span><span class="sxs-lookup"><span data-stu-id="77b14-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="77b14-184">På samma sätt om alternativet **Hoppa över** eller **Markera som registrerad** väljs för en misslyckad räkenskapsregistrering, lagras informationen i en räkenskapstransaktion.</span><span class="sxs-lookup"><span data-stu-id="77b14-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="77b14-185">En räkenskapstransaktion innehåller räkenskapssvar för räkenskapsenheten eller tjänsten.</span><span class="sxs-lookup"><span data-stu-id="77b14-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="77b14-186">Om processen för räkenskapsregistrering består av flera steg, skapas en räkenskapstransaktion för varje steg i processen som resulterade i en lyckad eller misslyckad registrering.</span><span class="sxs-lookup"><span data-stu-id="77b14-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="77b14-187">Räkenskapstransaktioner överförs till Administration av *P-jobb* tillsammans med transaktioner.</span><span class="sxs-lookup"><span data-stu-id="77b14-187">Fiscal transactions are transferred to Headquarters by the *P-job*, together with transactions.</span></span> <span data-ttu-id="77b14-188">På snabbfliken **räkenskapstransaktioner** på sidan **transaktioner** kan du visa de räkenskapstransaktioner som är kopplade till transaktioner.</span><span class="sxs-lookup"><span data-stu-id="77b14-188">On the **Fiscal transactions** FastTab of the **Store transactions** page, you can view the fiscal transactions that are linked to transactions.</span></span>

<span data-ttu-id="77b14-189">En räkenskapstransaktion innehåller följande information:</span><span class="sxs-lookup"><span data-stu-id="77b14-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="77b14-190">Information om processen för räkenskapsregistrering (process, kopplingsgrupp, koppling och så vidare).</span><span class="sxs-lookup"><span data-stu-id="77b14-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="77b14-191">Serienumret för räkenskapsenheten sparas också i fältet **registreringsnummer** om informationen ingår i räkenskapssvaret.</span><span class="sxs-lookup"><span data-stu-id="77b14-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="77b14-192">Status för räkenskapsregistreringen: **slutförd** för att registreringen har lyckats, **överhoppad** om operatören har valt alternativet **hoppa över** för en misslyckad registrering eller **markera som registrerad** om operatören har valt alternativ **Markera som registrerad**.</span><span class="sxs-lookup"><span data-stu-id="77b14-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="77b14-193">Informationskodtransaktioner som är relaterade till den valda skattetransaktionen.</span><span class="sxs-lookup"><span data-stu-id="77b14-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="77b14-194">Visa informationskodtransaktionerna, på snabbfliken **räkenskapstransaktioner** väljer du en räkenskapstransaktion som har statusen **överhoppad** eller **markeras som registrerats** och väljer sedan **informationskodtransaktioner**.</span><span class="sxs-lookup"><span data-stu-id="77b14-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="77b14-195">Räkenskapstexter för rabatter</span><span class="sxs-lookup"><span data-stu-id="77b14-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="77b14-196">Vissa länder eller regioner har särskilda önskemål om ytterligare texter som måste skrivas ut på skattekvitton när olika sorters rabatter tillämpas.</span><span class="sxs-lookup"><span data-stu-id="77b14-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="77b14-197">Räkenskapsintegration kan du ställa in en särskild text för en rabatt som skrivs ut efter en rabattrad på en kvittoskrivare.</span><span class="sxs-lookup"><span data-stu-id="77b14-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="77b14-198">För manuella rabatter kan du konfigurera en räkenskapstext för den informationskod som anges som **produktrabatt**-informationskod i funktionsprofil för kassa.</span><span class="sxs-lookup"><span data-stu-id="77b14-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="77b14-199">För mer information om hur man sätter upp räkenskapstexter för rabatter, se [skriva in räkenskapstexter för rabatter](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span><span class="sxs-lookup"><span data-stu-id="77b14-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="77b14-200">Skriva ut skatterapporter X och Z</span><span class="sxs-lookup"><span data-stu-id="77b14-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="77b14-201">Funktionen räkenskapsintegration stöder generering av rapporter vid dagens slut som är specifika för integrerad räkenskapsenhet eller tjänst:</span><span class="sxs-lookup"><span data-stu-id="77b14-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="77b14-202">Nya knappar som kör motsvarande operationer ska läggas till kassaskärmlayout.</span><span class="sxs-lookup"><span data-stu-id="77b14-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="77b14-203">Mer information finns i [skapa skatterapporter X/Z från kassan](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span><span class="sxs-lookup"><span data-stu-id="77b14-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="77b14-204">I exemplet på räkenskapsintegration bör dessa transaktioner anpassas till motsvarande verksamhet i räkenskapsenheten.</span><span class="sxs-lookup"><span data-stu-id="77b14-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="77b14-205">Exempel på räkenskapsintegration i Retail SDK</span><span class="sxs-lookup"><span data-stu-id="77b14-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="77b14-206">Följande exempel på räkenskapsintegration är tillgängliga i Retail SDK:</span><span class="sxs-lookup"><span data-stu-id="77b14-206">The following fiscal integration samples are currently available in the Retail SDK:</span></span>

- [<span data-ttu-id="77b14-207">Exempel på integrering av kvittoskrivare för Italien</span><span class="sxs-lookup"><span data-stu-id="77b14-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="77b14-208">Exempel på integrering av kvittoskrivare för Polen</span><span class="sxs-lookup"><span data-stu-id="77b14-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="77b14-209">Exempel på skatteregistreringstjänsten för Österrike</span><span class="sxs-lookup"><span data-stu-id="77b14-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="77b14-210">Exempel på skatteregistreringstjänsten för Tjeckien</span><span class="sxs-lookup"><span data-stu-id="77b14-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)
- [<span data-ttu-id="77b14-211">Exempel på integration av kontrollenhet för Sverige</span><span class="sxs-lookup"><span data-stu-id="77b14-211">Control unit integration sample for Sweden</span></span>](./emea-swe-fi-sample.md)

<span data-ttu-id="77b14-212">Följande funktioner för räkenskapsintegration finns också i Retail SDK men för närvarande utnyttjar inte i ramverket för räkenskapsintegration.</span><span class="sxs-lookup"><span data-stu-id="77b14-212">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="77b14-213">Migrering av den här funktionen till ramverket för räkenskapsintegration planeras för senare uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="77b14-213">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>


- [<span data-ttu-id="77b14-214">Digital signatur i Frankrike</span><span class="sxs-lookup"><span data-stu-id="77b14-214">Digital signature for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="77b14-215">Digital signatur för Norge</span><span class="sxs-lookup"><span data-stu-id="77b14-215">Digital signature for Norway</span></span>](emea-nor-cash-registers.md)

<span data-ttu-id="77b14-216">Följande tidigare funktioner för räkenskapsintegrering som är tillgängliga i Retail SDK använder inte ramverket för räkenskapsintegration och kommer att föråldras i senare uppdateringar:</span><span class="sxs-lookup"><span data-stu-id="77b14-216">The following legacy fiscal integration functionality that is available in Retail SDK does not use the fiscal integration framework and will be deprecated in later updates:</span></span>

- [<span data-ttu-id="77b14-217">Exempel på integration av kontrollenhet för Sverige (äldre)</span><span class="sxs-lookup"><span data-stu-id="77b14-217">Control unit integration sample for Sweden (legacy)</span></span>](./retail-sdk-control-unit-sample.md)
