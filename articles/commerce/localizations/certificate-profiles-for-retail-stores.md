---
title: Användardefinierade certifikatprofiler för butiker
description: Det här ämnet ger en översikt över hur certifikat används i butiker.
author: josaw
manager: annbe
ms.date: 10/09/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2020-10-09
ms.dyn365.ops.version: 10.0.15
ms.openlocfilehash: 03fe3d7fb64b2e9d0a06dc56654933f0c672782a
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 02/15/2021
ms.locfileid: "5225755"
---
# <a name="user-defined-certificate-profiles-for-retail-stores"></a><span data-ttu-id="90d05-103">Användardefinierade certifikatprofiler för butiker</span><span class="sxs-lookup"><span data-stu-id="90d05-103">User-defined certificate profiles for retail stores</span></span>

[!include [banner](../includes/banner.md)]


## <a name="overview"></a><span data-ttu-id="90d05-104">Översikt</span><span class="sxs-lookup"><span data-stu-id="90d05-104">Overview</span></span>

<span data-ttu-id="90d05-105">Det här avsnittet innehåller en översikt över de certifikatprofiler som är tillgängliga i Microsoft Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="90d05-105">This topic provides an overview of the certificate profiles that are available in Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="90d05-106">Den här funktionen utökar funktionen [Hantera hemligheter för butikskanaler](../dev-itpro/manage-secrets.md) genom att lägga till stöd för lokala certifikat.</span><span class="sxs-lookup"><span data-stu-id="90d05-106">This functionality extends the [Manage secrets for retail channels](../dev-itpro/manage-secrets.md) feature by adding support for local certificates.</span></span>

<span data-ttu-id="90d05-107">Medan POS körs i offlineläge kan den inte komma åt certifikaten som lagras i nyckelvalvet.</span><span class="sxs-lookup"><span data-stu-id="90d05-107">While the point of sale (POS) is running in offline mode, it can't access the certificates that are stored in the key vault.</span></span> <span data-ttu-id="90d05-108">Det lokala certifikatet ska användas i stället.</span><span class="sxs-lookup"><span data-stu-id="90d05-108">The local certificate should be used instead.</span></span> <span data-ttu-id="90d05-109">Följande funktioner stöds:</span><span class="sxs-lookup"><span data-stu-id="90d05-109">The following capabilities are supported:</span></span>

- <span data-ttu-id="90d05-110">Använda lokala certifikat i scenarier med nyckelvalvsreserv</span><span class="sxs-lookup"><span data-stu-id="90d05-110">Using local certificates in key vault fallback scenarios</span></span>
- <span data-ttu-id="90d05-111">Använda lokala certifikat utan nyckelvalv (t.ex. i en lokal installation)</span><span class="sxs-lookup"><span data-stu-id="90d05-111">Using local certificates without a key vault (for example in an on-premises installation)</span></span>
- <span data-ttu-id="90d05-112">Gradvis uppdatering av certifikat, där vissa butiker och terminaler använder en ny version av certifikatet, men andra butiker och terminaler fortsätter att använda den tidigare versionen</span><span class="sxs-lookup"><span data-stu-id="90d05-112">Gradual update of certificates, where some stores and terminals use a new version of the certificate, but other stores and terminals continue to use the previous version</span></span>

<span data-ttu-id="90d05-113">Med funktionen för certifikatprofiler kan du ange ett standardcertifikat och ange ordningen för sökning efter certifikat i samma certifikatprofil.</span><span class="sxs-lookup"><span data-stu-id="90d05-113">The certificate profiles functionality lets you specify a default certificate and set the order that certificates in the same certificate profile are searched in.</span></span> <span data-ttu-id="90d05-114">Den här funktionen ger också en liknande installationsmetod för lokala certifikat och certifikat för nyckelvalv.</span><span class="sxs-lookup"><span data-stu-id="90d05-114">This functionality also provides a similar setup approach for local certificates and Key Vault certificates.</span></span> <span data-ttu-id="90d05-115">Du kan lägga till företagsspecifika inställningar för certifikat, men det unika identifieraren för mellan företag för varje certifikat kan användas i Commerce-kanal.</span><span class="sxs-lookup"><span data-stu-id="90d05-115">You can add company-specific settings for certificates, but the unique cross-company identifier for each certificate can be used in the Commerce channels.</span></span>

### <a name="scenarios"></a><span data-ttu-id="90d05-116">Scenarier</span><span class="sxs-lookup"><span data-stu-id="90d05-116">Scenarios</span></span>

<span data-ttu-id="90d05-117">Funktionen för certifikatprofiler stöder följande scenarier i Commerce-kanaler:</span><span class="sxs-lookup"><span data-stu-id="90d05-117">The certificate profiles functionality supports the following scenarios in the Commerce channels:</span></span>

- <span data-ttu-id="90d05-118">Använda lokala certifikat i scenarier med nyckelvalvsreserv.</span><span class="sxs-lookup"><span data-stu-id="90d05-118">Use a local certificate in key vault fallback scenarios.</span></span> <span data-ttu-id="90d05-119">Här följer några exempel på dessa reservscenarier:</span><span class="sxs-lookup"><span data-stu-id="90d05-119">Here are some examples of these fallback scenarios:</span></span>

    - <span data-ttu-id="90d05-120">Det går inte att komma åt nyckelvalvlagret.</span><span class="sxs-lookup"><span data-stu-id="90d05-120">The key vault storage isn't accessible.</span></span>
    - <span data-ttu-id="90d05-121">Ett certifikat hittas inte i nyckelvalvlagret.</span><span class="sxs-lookup"><span data-stu-id="90d05-121">A certificate isn't found in the key vault storage.</span></span>
    - <span data-ttu-id="90d05-122">POS körs i offline-läge.</span><span class="sxs-lookup"><span data-stu-id="90d05-122">The POS is running in offline mode.</span></span>

- <span data-ttu-id="90d05-123">Använda lokala certifikat men utan att lagra dem i nyckelvalv (t.ex. i en lokal installation).</span><span class="sxs-lookup"><span data-stu-id="90d05-123">Use local certificates, but without storing them in the key vault (for example, in an on-premises installation).</span></span>
- <span data-ttu-id="90d05-124">Gör en gradvis uppdatering av certifikat, där en ny version av certifikatet bara används i butiker eller på terminaler där den nya versionen redan är tillgänglig.</span><span class="sxs-lookup"><span data-stu-id="90d05-124">Do a gradual update of certificates, where a new version of the certificate is used only in stores or on terminals where the new version is already available.</span></span>
- <span data-ttu-id="90d05-125">Använd samma certifikat i flera företag.</span><span class="sxs-lookup"><span data-stu-id="90d05-125">Use the same certificate in several companies.</span></span>

## <a name="set-up-certificate-profiles"></a><span data-ttu-id="90d05-126">Ställ in certifikatprofiler</span><span class="sxs-lookup"><span data-stu-id="90d05-126">Set up certificate profiles</span></span>

<span data-ttu-id="90d05-127">I proceduren nedan beskrivs hur du ställer in certifikatprofiler.</span><span class="sxs-lookup"><span data-stu-id="90d05-127">The following procedure explains how to set up certificate profiles.</span></span> <span data-ttu-id="90d05-128">Innan du använder certifikatprofiler i Commerce-kanalerna följer du stegen nedan för att konfigurera inställningarna.</span><span class="sxs-lookup"><span data-stu-id="90d05-128">Before you use certificate profiles in the Commerce channels, follow these steps to configure the settings.</span></span>

1. <span data-ttu-id="90d05-129">I arbetsytan **funktionshantering** aktiverar du funktionen **Användardefinierade certifikatprofiler för butiker**.</span><span class="sxs-lookup"><span data-stu-id="90d05-129">In the **Feature management** workspace, turn on the **User-defined certificate profiles for retail stores** feature.</span></span>
2. <span data-ttu-id="90d05-130">Öppna **Systemadministration \> Inställningar \> Certifikatprofiler**.</span><span class="sxs-lookup"><span data-stu-id="90d05-130">Go to **System administration \> Setup \> Certificate profiles**.</span></span>
3. <span data-ttu-id="90d05-131">Skapa en post och ange fältet **Certifikatprofil**, **Namn** och **Beskrivning** för den.</span><span class="sxs-lookup"><span data-stu-id="90d05-131">Create a record, and set the **Certificate profile**, **Name**, and **Description** fields for it.</span></span>

    > [!NOTE]
    > <span data-ttu-id="90d05-132">Certifikatprofilen är en unik identifierare för ett certifikat för alla företag och Commerce-komponenter.</span><span class="sxs-lookup"><span data-stu-id="90d05-132">The certificate profile is a unique identifier of a certificate across all companies and Commerce components.</span></span>

3. <span data-ttu-id="90d05-133">På fliken **Juridiska personer**, lägg till en rad och välj den juridiska enhet (företag) som den aktuella certifikatprofilen ska användas till.</span><span class="sxs-lookup"><span data-stu-id="90d05-133">On the **Legal entities** tab, add a line, and select the legal entity (company) that the current certificate profile should be used for.</span></span> <span data-ttu-id="90d05-134">Om certifikatprofilen ska användas för flera juridiska personer upprepar du det här steget för att lägga till en rad för varje ytterligare juridisk person.</span><span class="sxs-lookup"><span data-stu-id="90d05-134">If the certificate profile should be used for multiple legal entities, repeat this step to add a line for each additional legal entity.</span></span>
4. <span data-ttu-id="90d05-135">Välj **Inställningar** för att öppna sidan **Inställningar för certifikatprofil**, där du kan ange företagsspecifika inställningar för certifikatprofilen.</span><span class="sxs-lookup"><span data-stu-id="90d05-135">Select **Settings** to open the **Certificate profile settings** page, where you can enter company-specific settings for the certificate profile.</span></span>

### <a name="certificate-profile-settings"></a><span data-ttu-id="90d05-136">Certifikatprofilinställningar</span><span class="sxs-lookup"><span data-stu-id="90d05-136">Certificate profile settings</span></span>

<span data-ttu-id="90d05-137">När du väljer **inställningar** för certifikatprofilrader visas sidan **Inställningar för certifikatprofil**.</span><span class="sxs-lookup"><span data-stu-id="90d05-137">When you select **Settings** for certificate profile lines, the **Certificate profile settings** page appears.</span></span> <span data-ttu-id="90d05-138">På den här sidan kan du ange vilka certifikat som kan användas när den aktuella certifikatprofilen anropas i Commerce-kanalen.</span><span class="sxs-lookup"><span data-stu-id="90d05-138">This page lets you specify which certificates can be used when the current certificate profile is called in the Commerce channels.</span></span> <span data-ttu-id="90d05-139">Du kan även ange i vilken ordning som certifikatet ska genomsökas.</span><span class="sxs-lookup"><span data-stu-id="90d05-139">You can also specify the order that certificates should be searched in.</span></span>

> [!NOTE]
> <span data-ttu-id="90d05-140">Fältet **prioritet** ställs automatiskt in.</span><span class="sxs-lookup"><span data-stu-id="90d05-140">The **Priority** field is automatically set.</span></span> <span data-ttu-id="90d05-141">Värdet **1** representerar högsta prioritet.</span><span class="sxs-lookup"><span data-stu-id="90d05-141">A value of **1** represents the highest priority.</span></span> <span data-ttu-id="90d05-142">När en ny rad läggs till på sidan **Inställningar för certifikatprofil**, anges prioriteten till ett nummer som är en högre än prioriteten för den föregående raden.</span><span class="sxs-lookup"><span data-stu-id="90d05-142">When a new line is added on the **Certificate profile settings** page, its priority is set to a number that is one more than the priority of the previous line.</span></span> <span data-ttu-id="90d05-143">Om du vill ändra prioriteten för en viss rad markerar du raden och väljer sedan antingen **Flytta upp** om du vill öka prioriteten eller **Flytta ned** för att minska prioriteten.</span><span class="sxs-lookup"><span data-stu-id="90d05-143">To change the priority of a specific line, select the line, and then select either **Move up** to increase the priority or **Move down** to decrease the priority.</span></span>

<span data-ttu-id="90d05-144">När du lägger till en ny rad på sidan **Inställningar för certifikatprofil** anger du följande fält:</span><span class="sxs-lookup"><span data-stu-id="90d05-144">When you add a new line to the **Certificate profile settings** page, set the following fields:</span></span>

- <span data-ttu-id="90d05-145">**Platstyp** – Välj den plats där certifikatet lagras.</span><span class="sxs-lookup"><span data-stu-id="90d05-145">**Location type** – Select the location where the certificate is stored.</span></span> <span data-ttu-id="90d05-146">Det finns två möjliga värden för det här fältet: **lokalt certifikat** och **nyckelvalv**.</span><span class="sxs-lookup"><span data-stu-id="90d05-146">This field has two possible values: **Local certificate** and **Key Vault**.</span></span>
- <span data-ttu-id="90d05-147">**Nyckelvalv certifikat** – det här fältet är obligatoriskt om du ställer in fältet **platstyp** på **nyckelvalv**.</span><span class="sxs-lookup"><span data-stu-id="90d05-147">**Key Vault certificate** – This field is required if you set the **Location type** field to **Key Vault**.</span></span> <span data-ttu-id="90d05-148">Använd den för att ange hemlighet för nyckelvalv certifikat.</span><span class="sxs-lookup"><span data-stu-id="90d05-148">Use it to specify a Key Vault certificate secret.</span></span>

    > [!NOTE]
    > <span data-ttu-id="90d05-149">Innan du använder ett nyckelvalv i certifikatprofiler måste du ladda upp ett certifikat till nyckelvalvlagret och följa instruktionerna i [Konfigurera Azure Key Vault-klienten](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span><span class="sxs-lookup"><span data-stu-id="90d05-149">Before you use a Key Vault certificate in certificate profiles, be sure to upload a certificate to the key vault storage, and follow the instructions in [Set up the Azure Key Vault client](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span></span>

- <span data-ttu-id="90d05-150">**Butiksnamn** – det här fältet är valfritt och det är bara tillgängligt om du anger fältet **platstyp** till **lokalt certifikat**.</span><span class="sxs-lookup"><span data-stu-id="90d05-150">**Store name** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="90d05-151">Använd den för att ange ett standardnamn för butiken som ska användas för att söka efter lokala certifikat.</span><span class="sxs-lookup"><span data-stu-id="90d05-151">Use it to specify a default store name that should be used to search local certificates.</span></span>
- <span data-ttu-id="90d05-152">**Butiksplats** – det här fältet är valfritt och det är bara tillgängligt om du anger fältet **platstyp** till **lokalt certifikat**.</span><span class="sxs-lookup"><span data-stu-id="90d05-152">**Store location** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="90d05-153">Använd den för att ange ett standardplats för butiken som ska användas för att söka efter lokala certifikat.</span><span class="sxs-lookup"><span data-stu-id="90d05-153">Use it to specify a default store location that should be used to search local certificates.</span></span>

    > [!NOTE]
    > <span data-ttu-id="90d05-154">Standardnamnet på butiken och lagringsplatsen läggs till för att förenkla processen att söka i lokala certifikat i Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="90d05-154">The default store name and store location are added to simplify the process of searching local certificates in the Commerce runtime.</span></span> <span data-ttu-id="90d05-155">X509StoreProvider har en lista med mappar där certifikat lagras.</span><span class="sxs-lookup"><span data-stu-id="90d05-155">X509StoreProvider has a list of folders where certificates are stored.</span></span> <span data-ttu-id="90d05-156">Om standardnamnet på butiken och standardplatsen för arkivet inte anges försöker X509StoreProvider hitta ett certifikat i de andra mapparna i listan.</span><span class="sxs-lookup"><span data-stu-id="90d05-156">If the default store name and the default store location aren't specified, X509StoreProvider tries to find a certificate in the other folders on its list.</span></span>

- <span data-ttu-id="90d05-157">**Tumavtryck** – det här fältet krävs och det är bara tillgängligt om du anger fältet **platstyp** till **lokalt certifikat**.</span><span class="sxs-lookup"><span data-stu-id="90d05-157">**Thumbprint** – This field is required and available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="90d05-158">Använd den för att ange tumavtryck för certifikatet.</span><span class="sxs-lookup"><span data-stu-id="90d05-158">Use it to specify the certificate thumbprint.</span></span>
- <span data-ttu-id="90d05-159">**Kommentarer** – det här fältet är valfritt och låter användarna ange noteringar.</span><span class="sxs-lookup"><span data-stu-id="90d05-159">**Comments** – This field is optional and lets users enter notes.</span></span>

### <a name="workflow-searching-certificates-in-the-commerce-runtime"></a><span data-ttu-id="90d05-160">Arbetsflöde: söka efter certifikat i Commerce Runtime</span><span class="sxs-lookup"><span data-stu-id="90d05-160">Workflow: Searching certificates in the Commerce runtime</span></span>

<span data-ttu-id="90d05-161">Här är det grundläggande arbetsflödet som används för att söka efter ett certifikat när en certifikatprofil anropas i Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="90d05-161">Here is the basic workflow that is used to search for a certificate when a certificate profile is called in the Commerce runtime.</span></span>

1. <span data-ttu-id="90d05-162">Systemet identifierar om certifikatprofilen har företagsspecifika inställningar för den aktuella juridiska personen.</span><span class="sxs-lookup"><span data-stu-id="90d05-162">The system identifies whether the certificate profile has company-specific settings for the current legal entity.</span></span>
1. <span data-ttu-id="90d05-163">Systemet försöker hitta certifikatet med hjälp av värdena på sidan **Inställningar för certifikatprofil** för den rad där fältet **prioritet** anges till **1**.</span><span class="sxs-lookup"><span data-stu-id="90d05-163">The system tries to find the certificate by using the values on the **Certificate profile settings** page for the line where the **Priority** field is set to **1**.</span></span>

    - <span data-ttu-id="90d05-164">Om fältet **platstyp** är inställt på **nyckelvalv** används värdet för fältet **hemlighet för nyckelvalvcertifikat** för att söka efter certifikatet på sidan **parametrar för nyckelvalv**.</span><span class="sxs-lookup"><span data-stu-id="90d05-164">If the **Location type** field is set to **Key Vault**, the value of the **Key Vault certificate secret** field is used to search for the certificate on the **Key vault parameters** page.</span></span> <span data-ttu-id="90d05-165">Certifikatet söks sedan igenom i nyckelvalvlagret.</span><span class="sxs-lookup"><span data-stu-id="90d05-165">The certificate is then searched for in the key vault storage.</span></span>
    - <span data-ttu-id="90d05-166">Om fältet **platstyp** är inställt på **lokalt certifikat**, X509StoreProvider först en sökning efter certifikatet med hjälp av standardnamnet på butiken och lagringsplatsen, om dessa parametrar har angetts.</span><span class="sxs-lookup"><span data-stu-id="90d05-166">If the **Location type** field is set to **Local certificate**, X509StoreProvider first searches for the certificate by using the default store name and store location, if these parameters are specified.</span></span> <span data-ttu-id="90d05-167">Därefter genomsöks alla andra mappar i listan med mappar.</span><span class="sxs-lookup"><span data-stu-id="90d05-167">It then searches in all other folders on its list of folders.</span></span>

1. <span data-ttu-id="90d05-168">Om certifikatet inte hittas upprepas processen för raden där fältet **prioritet** är inställt på **2** och så vidare.</span><span class="sxs-lookup"><span data-stu-id="90d05-168">If the certificate isn't found, the process is repeated for the line where the **Priority** field is set to **2**, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="90d05-169">Om certifikatprofilen inte har några inställningar för den aktuella juridiska personen, eller om certifikatsökningen inte lyckas för alla rader på sidan **Inställningar för certifikatprofil**, hittas inte certifikatet.</span><span class="sxs-lookup"><span data-stu-id="90d05-169">If the certificate profile has no settings for the current legal entity, or if the certificate search is unsuccessful for all lines on the **Certificate profile settings** page, the certificate isn't found.</span></span>

#### <a name="caching-the-results-of-certificate-searches"></a><span data-ttu-id="90d05-170">Cachelagra resultaten av certifikatsökningar</span><span class="sxs-lookup"><span data-stu-id="90d05-170">Caching the results of certificate searches</span></span>

<span data-ttu-id="90d05-171">Resultaten av certifikatsökningar cachelagras.</span><span class="sxs-lookup"><span data-stu-id="90d05-171">The results of certificate searches are cached.</span></span> <span data-ttu-id="90d05-172">Standard förfallotiden för en cache är en timme.</span><span class="sxs-lookup"><span data-stu-id="90d05-172">The default expiration time for a cache is one hour.</span></span> <span data-ttu-id="90d05-173">Den här tiden kan dock anpassas och kan ställas in på ett maximalt värde på 24 timmar.</span><span class="sxs-lookup"><span data-stu-id="90d05-173">However, this time can be customized and can be set to a maximum value of 24 hours.</span></span>

### <a name="gradual-update"></a><span data-ttu-id="90d05-174">Gradvis uppdatering</span><span class="sxs-lookup"><span data-stu-id="90d05-174">Gradual update</span></span>

<span data-ttu-id="90d05-175">Om en ny version av certifikatet introduceras, men det inte kan uppdateras i alla butiker samtidigt, kan funktionen för certifikatprofil uppdateras gradvis.</span><span class="sxs-lookup"><span data-stu-id="90d05-175">If a new version of the certificate is introduced, but it can't be updated in all stores at the same time, the certificate profiles functionality enables the certificate to be updated gradually.</span></span>

1. <span data-ttu-id="90d05-176">Sök efter en certifikatprofil och raden som ska uppdateras och välj sedan **inställningar**.</span><span class="sxs-lookup"><span data-stu-id="90d05-176">Find a certificate profile and the line that should be updated, and then select **Settings**.</span></span>
1. <span data-ttu-id="90d05-177">Lägg till en rad och ange inställningar som är relaterade till den senaste versionen av certifikatet.</span><span class="sxs-lookup"><span data-stu-id="90d05-177">Add a line, and specify settings that are related to the latest version of the certificate.</span></span>
1. <span data-ttu-id="90d05-178">Öka värdet **prioritet** för den nya raden.</span><span class="sxs-lookup"><span data-stu-id="90d05-178">Increase the **Priority** value of the new line.</span></span> <span data-ttu-id="90d05-179">Använd knappen **Flytta upp** om du vill flytta raden så att den ligger ovanför raden för den föregående versionen av samma certifikat.</span><span class="sxs-lookup"><span data-stu-id="90d05-179">Use the **Move up** button to move the line so that it's above the line for the previous version of the same certificate.</span></span>

> [!NOTE]
> <span data-ttu-id="90d05-180">I Commerce Runtime kommer den nya versionen av certifikatet att anropas först.</span><span class="sxs-lookup"><span data-stu-id="90d05-180">In the Commerce runtime, the new version of the certificate will be called first.</span></span> <span data-ttu-id="90d05-181">Om certifikatet ännu inte har uppdaterats i en specifik butik eller på en specifik terminal kommer den föregående versionen att anropas.</span><span class="sxs-lookup"><span data-stu-id="90d05-181">If the certificate hasn't yet been updated in a specific store or on a specific terminal, the previous version will be called.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]