---
title: Beräkna lagertillgänglighet för butikskanaler
description: I det här avsnittet beskrivs hur ett företag kan använda Microsoft Dynamics 365 Commerce för att visa uppskattade tillgängliga produkter i online- och butikskanaler.
author: hhainesms
ms.date: 04/23/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: hhaines
ms.search.validFrom: 2020-02-11
ms.dyn365.ops.version: Release 10.0.10
ms.openlocfilehash: 96a600279b7a90d6626d23ee8868de13e9dd0f14
ms.sourcegitcommit: dc4898aa32f381620c517bf89c7856e693563ace
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 06/17/2021
ms.locfileid: "6270895"
---
# <a name="calculate-inventory-availability-for-retail-channels"></a><span data-ttu-id="8e198-103">Beräkna lagertillgänglighet för butikskanaler</span><span class="sxs-lookup"><span data-stu-id="8e198-103">Calculate inventory availability for retail channels</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="8e198-104">I det här avsnittet beskrivs hur ett företag kan använda Microsoft Dynamics 365 Commerce för att visa uppskattade tillgängliga produkter i online- och butikskanaler.</span><span class="sxs-lookup"><span data-stu-id="8e198-104">This topic describes how a company can use Microsoft Dynamics 365 Commerce to view estimated on-hand availability for products in the online and store channels.</span></span>

## <a name="accuracy-of-inventory-availability"></a><span data-ttu-id="8e198-105">Exakthet för lagertillgänglighet</span><span class="sxs-lookup"><span data-stu-id="8e198-105">Accuracy of inventory availability</span></span>

<span data-ttu-id="8e198-106">Commerce använder flera servrar och databaser för att garantera skalbarhet och prestanda.</span><span class="sxs-lookup"><span data-stu-id="8e198-106">Commerce uses multiple servers and databases to ensure scalability and performance.</span></span> <span data-ttu-id="8e198-107">Därför är det viktigt att du förstår att de tillgängliga lagervärden som tillhandahålls via kassaprogrammet (POS), API:er för lagertillgänglighet för näthandel samt lagerbehållningssidorna i Commerce-administration kanske inte är 100 procent korrekta i realtid.</span><span class="sxs-lookup"><span data-stu-id="8e198-107">Therefore, it's important that you understand that the available inventory values that are provided through the point of sale (POS) application, the e-commerce inventory availability application programming interfaces (APIs), and the on-hand inventory pages in Commerce headquarters might not be 100 percent accurate in real time.</span></span> <span data-ttu-id="8e198-108">Om transaktioner som skapas för produkter i nät- eller butikskanalen ännu inte har synkroniserats med Commerce-administrationen, kanske lagerbehållningssidorna i administrationen inte visar ett korrekt lager värde i realtid för dessa produkter.</span><span class="sxs-lookup"><span data-stu-id="8e198-108">If transactions that are created for products in the online or store channel haven't yet been synced to headquarters, the on-hand inventory pages in headquarters might not show an accurate real-time inventory value for those products.</span></span> <span data-ttu-id="8e198-109">Om du har konfigurerat ditt företag så att användare i administrationen eller andra integrerade program kan sälja, ta emot, returnera eller på annat sätt justera lagret från en butik eller på ett nätlager, kanske inte kassa- eller nätkanalen har all information som krävs för att visa korrekta värden för artiklar i realtid.</span><span class="sxs-lookup"><span data-stu-id="8e198-109">Conversely, if you configured your company so that users in headquarters or other integrated applications can sell, receive, return, or otherwise adjust inventory out of a store or online warehouse, the POS or online channel might not have all the information that is required to show accurate real-time values for items.</span></span>

<span data-ttu-id="8e198-110">Det är vitalt att du förstår att all tillgänglig data som ges under användningsdagen betraktas som ett uppskattat värde.</span><span class="sxs-lookup"><span data-stu-id="8e198-110">It's critical to understand that all on-hand availability data that is provided during the operational day is considered an estimated value.</span></span> <span data-ttu-id="8e198-111">Om du försöker jämföra den lagerbehållningsinformation som programmet ger med det verkliga fysiska lagret på hyllorna, eller om du försöker jämföra de behållningsvärden som visas i kassan med de faktiska data som du hittar för samma lagerställe i administration, kan värdena därför komma att skilja sig åt.</span><span class="sxs-lookup"><span data-stu-id="8e198-111">Therefore, if you try to compare the on-hand inventory information that the application provides with actual physical inventory on the shelves, or if you try to compare the on-hand values that are shown in POS with the on-hand data that you find for the same warehouse in headquarters, the values might differ.</span></span> <span data-ttu-id="8e198-112">Denna skillnad förväntas under användningsdagen och bör inte betraktas som en utleverans.</span><span class="sxs-lookup"><span data-stu-id="8e198-112">This difference during the operational day is expected and should not be considered an issue.</span></span> <span data-ttu-id="8e198-113">Om du vill granska data och se till att de värden som finns i kassa, API:er och administration matchar de faktiska fysiska enheterna som finns i butiken eller på lagerhyllorna, är det bäst att göra detta efter att kanalåtgärderna har avslutats för dagen och alla transaktioner har synkroniserats korrekt mellan administration och kanaler.</span><span class="sxs-lookup"><span data-stu-id="8e198-113">If you want to audit data and make sure that the values provided in POS, APIs, and headquarters match the actual physical units that you find on your store or warehouse shelves, the best time to do it is after channel operations have stopped for the day and all transactions have been correctly synced between headquarters and the channels.</span></span>

## <a name="channel-side-inventory-calculation"></a><span data-ttu-id="8e198-114">Lagerberäkning på kanalsidan</span><span class="sxs-lookup"><span data-stu-id="8e198-114">Channel-side inventory calculation</span></span>

<span data-ttu-id="8e198-115">Lagerberäkningen på kanalsidan är en mekanism som tar den senast kända kanallagerdatan i Commerce-administrationen som grund och därefter faktorer i ytterligare lagerändringar som inträffat på kanalsidan som inte inkluderats i denna grund för att beräkna en uppskattad lagerbehållning i närapå realtid.</span><span class="sxs-lookup"><span data-stu-id="8e198-115">The channel-side inventory calculation is a mechanism that takes the last-known channel inventory data in Commerce headquarters as a baseline, and then factors in additional inventory changes that occurred on the channel side that aren't included in that baseline to calculate a near-real-time estimated on-hand inventory.</span></span> 

<span data-ttu-id="8e198-116">Följande lagerändringar beaktas för närvarande i lagerberäkningslogiken på kanalsidan:</span><span class="sxs-lookup"><span data-stu-id="8e198-116">The following inventory changes are currently considered in the channel-side inventory calculation logic:</span></span>

- <span data-ttu-id="8e198-117">Lager som säljs via cash-and-carry-order i butik</span><span class="sxs-lookup"><span data-stu-id="8e198-117">Inventory sold through cash-and-carry orders in store</span></span>
- <span data-ttu-id="8e198-118">Lager som säljs via kundorder i butik eller nätkanal</span><span class="sxs-lookup"><span data-stu-id="8e198-118">Inventory sold through customer orders in store or online channel</span></span>
- <span data-ttu-id="8e198-119">Lager som returnerats till butiken</span><span class="sxs-lookup"><span data-stu-id="8e198-119">Inventory returned to store</span></span>
- <span data-ttu-id="8e198-120">Lager som är uppfyllt (plocka, packa, skeppa) från butikslagerställe</span><span class="sxs-lookup"><span data-stu-id="8e198-120">Inventory fulfilled (pick, pack, ship) from store warehouse</span></span>

<span data-ttu-id="8e198-121">Om du vill använda lagerberäkningen på kanalsidan måste först en periodisk ögonblicksbild av lagerdata från administrationen som skapats av jobbet **Produkttillgänglighet** skickas till kanaldatabaserna.</span><span class="sxs-lookup"><span data-stu-id="8e198-121">To use the channel-side inventory calculation, as a prerequisite a periodic snapshot of inventory data from headquarters created by the **Product availability** job must be sent to the channel databases.</span></span> <span data-ttu-id="8e198-122">Ögonblicksbilden representerar den information som administration har om lagertillgänglighet för en specifik kombination av en produkt eller produktvariant och ett lagerställe.</span><span class="sxs-lookup"><span data-stu-id="8e198-122">The snapshot represents the information that headquarters has about inventory availability for a specific combination of a product or product variant and a warehouse.</span></span> <span data-ttu-id="8e198-123">Den inkluderar bara de lagertransaktioner som bearbetats och bokförts i administrationen vid tidpunkten för ögonblicksbilden, och den kanske inte är 100 procent korrekt i realtid på grund av den konstanta försäljningsbearbetningen som sker på distribuerade servrar.</span><span class="sxs-lookup"><span data-stu-id="8e198-123">It includes only the inventory transactions that were processed and posted in headquarters at the time when the snapshot was taken, and it might not be 100 percent accurate in real time because of the constant sales processing that occurs across distributed servers.</span></span>

- <span data-ttu-id="8e198-124">Om lagret såldes för en produkt i ett butikslager med hämtköp ("cash-and-carry") eller asynkron försäljning av kundorder i kassaprogrammet, finns det ingen omedelbar information om den relaterade lagerkvantiteten för försäljningen i administrationen.</span><span class="sxs-lookup"><span data-stu-id="8e198-124">If inventory was sold for a product in a store through a cash-and-carry or asynchronous customer order sale in the POS application, headquarters won't immediately have information about the related inventory issue transaction for the sale.</span></span> <span data-ttu-id="8e198-125">Administrationen kommer att ha information om lagret som säljs för dessa typer av butiksförsäljning först när P-jobbet överför den relaterade transaktionen från butikens kanaldatabas till administrationen och relaterade försäljningsorder skapas genom utdragsbokföring eller av indroppningsbaserad bokföring.</span><span class="sxs-lookup"><span data-stu-id="8e198-125">Headquarters will have information about the inventory that is sold for these types of store sales only after the P-job uploads the related transaction from the store's channel database into headquarters and the related sales orders are created through statement posting or the trickle feed posting processes.</span></span> <span data-ttu-id="8e198-126">När ordern skapas i administration skapas relaterade lagertransaktioner.</span><span class="sxs-lookup"><span data-stu-id="8e198-126">The process of creating the orders in headquarters creates the related inventory transactions.</span></span> 
- <span data-ttu-id="8e198-127">För näthandelskanalorder har administrationen information om lagertransaktionerna först när transaktionerna har skickats till administration via P-jobbet och synkroniseringen av ordern har slutförts.</span><span class="sxs-lookup"><span data-stu-id="8e198-127">For e-commerce channel orders, headquarters has information about the inventory transactions only after the transactions are sent to headquarters through the P-job and the order synchronization process is completed.</span></span>

<span data-ttu-id="8e198-128">Följ de här stegen om du vill ta en ögonblicksbild av lagret i Commerce-administrationen.</span><span class="sxs-lookup"><span data-stu-id="8e198-128">To take a snapshot of inventory in Commerce headquarters, follow these steps.</span></span>

1. <span data-ttu-id="8e198-129">Gå till **Retail och Commerce \> Retail och Commerce IT \> Produkter och lager \> Produkttillgänglighet**.</span><span class="sxs-lookup"><span data-stu-id="8e198-129">Go to **Retail and Commerce \> Retail and Commerce IT \> Products and inventory \> Product availability**.</span></span>
1. <span data-ttu-id="8e198-130">Välj **OK** för att köra jobbet **Produkttillgänglighet**.</span><span class="sxs-lookup"><span data-stu-id="8e198-130">Select **OK** to run the **Product availability** job.</span></span> <span data-ttu-id="8e198-131">Du kan även tidsplanera det här jobbet så att det körs i en batch.</span><span class="sxs-lookup"><span data-stu-id="8e198-131">You can also schedule this job to run in batch.</span></span>

<span data-ttu-id="8e198-132">När jobbet **Produkttillgänglighet** har slutförts måste de data som samlats in skickas till kanalens databaser så att den senaste ögonblicksbilden för administration kan övervägas vid beräkningen av uppskattad lagerhållning på kanalsidan.</span><span class="sxs-lookup"><span data-stu-id="8e198-132">After the **Product availability** job has finished running, the data that was captured must be pushed to the channel databases, so that the latest headquarters inventory snapshot can be considered in the channel-side calculation of estimated on-hand inventory.</span></span>

<span data-ttu-id="8e198-133">Om du vill synkronisera ögonblicksbilddata från administrationen till dina kanaldatabaser gör du på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="8e198-133">To sync snapshot data from headquarters to your channel databases, follow these steps.</span></span>

1. <span data-ttu-id="8e198-134">Gå till **Retail and Commerce \> Retail and Commerce-IT \> Distributionsschema**.</span><span class="sxs-lookup"><span data-stu-id="8e198-134">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="8e198-135">Kör jobbet **1130** (**Produkttillgänglighet**) om du vill synkronisera den ögonblicksbilddata som jobbet **Produkttillgänglighet** har skapat från administrationen till kanaldatabaserna.</span><span class="sxs-lookup"><span data-stu-id="8e198-135">Run the **1130** (**Product availability**) job to sync the snapshot data that the **Product availability** job has created from headquarters to your channel databases.</span></span>

## <a name="inventory-availability-apis-for-e-commerce"></a><span data-ttu-id="8e198-136">API:er för lagertillgänglighet i näthandel</span><span class="sxs-lookup"><span data-stu-id="8e198-136">Inventory availability APIs for e-commerce</span></span>

<span data-ttu-id="8e198-137">Commerce innehåller följande API:er för näthandelsscenarier om du vill efterfråga lagertillgängligheten för en produkt:</span><span class="sxs-lookup"><span data-stu-id="8e198-137">Commerce provides the following APIs for e-commerce scenarios to query inventory availability of a product:</span></span>

- <span data-ttu-id="8e198-138">**GetEstimatedAvailability** – Använd detta API när du vill söka efter en produkt eller produktvariant i det nätkanallagerställe eller de lagerställen som är kopplade till nätkanalens uppfyllelsegrupp.</span><span class="sxs-lookup"><span data-stu-id="8e198-138">**GetEstimatedAvailability** – Use this API to query inventory for a product or product variant in the online channel warehouse or warehouses that are linked to the online channel's fulfillment group.</span></span>
- <span data-ttu-id="8e198-139">**GetEstimatedProductWarehouseAvailability** – Använd detta API för att efterfråga lager för en produkt eller en produktvariant från ett visst lagerställe.</span><span class="sxs-lookup"><span data-stu-id="8e198-139">**GetEstimatedProductWarehouseAvailability** – Use this API to query inventory for a product or product variant from a specific warehouse.</span></span>

> [!NOTE]
> <span data-ttu-id="8e198-140">Dessa API:er ersätter API:erna **GetProductAvailabilities** och **GetAvailableInventoryNearby** i Commerce version 10.0.7 och tidigare.</span><span class="sxs-lookup"><span data-stu-id="8e198-140">These APIs replace the **GetProductAvailabilities** and **GetAvailableInventoryNearby** APIs in Commerce release 10.0.7 and earlier.</span></span>

<span data-ttu-id="8e198-141">Båda API:er använder intern beräkningslogik på kanalsidan och returnerar uppskattad **fysiskt tillgänglig** kvantitet, **totalt tillgänglig** kvantitet, **måttenhet (UoM)** samt **lagernivå** för begärd produkt och lagerhållning.</span><span class="sxs-lookup"><span data-stu-id="8e198-141">Both APIs internally use the channel-side calculation logic and return estimated **physical available** quantity, **total available** quantity, **unit of measure (UoM)**, and **inventory level** for the requested product and warehouse.</span></span> <span data-ttu-id="8e198-142">Returnerade värden kan visas på din näthandelssajt om du vill det, eller också kan de användas för att utlösa annan affärslogik på din näthandelssajt.</span><span class="sxs-lookup"><span data-stu-id="8e198-142">The returned values can be shown on your e-commerce site if you want, or they can be used to trigger other business logic on your e-commerce site.</span></span> <span data-ttu-id="8e198-143">Du kan till exempel förhindra inköp av produkter med lagernivån "ej i lager".</span><span class="sxs-lookup"><span data-stu-id="8e198-143">For example, you can prevent the purchase of products with an "out of stock" inventory level.</span></span>

<span data-ttu-id="8e198-144">Även om andra API:er som är tillgängliga i Commerce kan gå direkt till administrationen för att hämta kvantiteten för produkter, rekommenderar vi inte att de används i en näthandelsmiljö på grund av potentiella prestandaproblem och den påverkan som dessa frekventa förfrågningar kan ha på dina administrationsservrar.</span><span class="sxs-lookup"><span data-stu-id="8e198-144">Although other APIs that are available in Commerce can go directly to headquarters to fetch on-hand quantities for products, we don't recommend that they be used in an e-commerce environment because of potential performance issues and the impact that these frequent requests can have on your headquarters servers.</span></span> <span data-ttu-id="8e198-145">Med hjälp av beräkningen på kanalsidan kan de två API:erna som nämns ovan ge en mer exakt uppskattning av en produkts tillgänglighet, detta genom att ta hänsyn till de transaktioner som skapats i de kanaler som administrationen ännu inte känner till.</span><span class="sxs-lookup"><span data-stu-id="8e198-145">Additionally, with channel-side calculation, the two APIs mentioned above can provide a more accurate estimate of a product's availability by taking into account the transactions created in the channels that aren’t yet known to headquarters.</span></span>

<span data-ttu-id="8e198-146">Om du vill använda dessa två API:er måste du aktivera funktionen **Optimerad beräkning för produkttillgänglighet** via arbetsytan **Funktionshantering** i administrationen.</span><span class="sxs-lookup"><span data-stu-id="8e198-146">To use the two APIs, you must enable the **Optimized product availability calculation** feature through the **Feature management** workspace in headquarters.</span></span> <span data-ttu-id="8e198-147">Om dina näthandels- och butikskanaler använder samma uppfyllelselagerställen, måste du även aktivera funktionen för **Utökad lagerberäkningslogik på kanalsidan för näthandel** för att beräkningslogiken på kanalsidan ska användas i de två API:erna för att dela upp icke-bokförda transaktioner (hämtköp, kundorder, returer) som skapats i butikskanalen.</span><span class="sxs-lookup"><span data-stu-id="8e198-147">If your online and store channels use the same fulfillment warehouses, you must also enable the **Enhanced e-Commerce channel-side inventory calculation logic** feature to have the channel-side calculation logic within the two APIs to factor in the unposted transactions (cash-and-carry, customer orders, returns) created in the store channel.</span></span> <span data-ttu-id="8e198-148">Du måste köra jobbet **1070** (**Kanalkonfiguration**) efter det att du har aktiverat dessa funktioner.</span><span class="sxs-lookup"><span data-stu-id="8e198-148">You will need to run the **1070** (**Channel configuration**) job after enabling these features.</span></span>

<span data-ttu-id="8e198-149">Om du vill definiera hur produktkvantiteten ska returneras i API-utleveransen följer du dessa steg.</span><span class="sxs-lookup"><span data-stu-id="8e198-149">To define how product quantity should be returned in the API output, follow these steps.</span></span>

1. <span data-ttu-id="8e198-150">Öppna **Retail och Commerce \> Administrationsinställning \> Parametrar \> Commerce-parametrar**.</span><span class="sxs-lookup"><span data-stu-id="8e198-150">Go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce parameters**.</span></span>
1. <span data-ttu-id="8e198-151">Välj fliken **Lager** – på snabbfliken **API:er för lagertillgänglighet för e-Commerce** konfigurerar du sedan värdet för inställningen **Kvantitet för API-utdata**.</span><span class="sxs-lookup"><span data-stu-id="8e198-151">Select the **Inventory** tab, and then on the **Inventory availability APIs for e-Commerce** FastTab configure the value of the **Quantity in API output** setting.</span></span>
1. <span data-ttu-id="8e198-152">Kör jobbet **1070** (**kanalkonfiguration**) för att synkronisera de senaste inställningarna med kanaler.</span><span class="sxs-lookup"><span data-stu-id="8e198-152">Run the **1070** (**Channel configuration**) job to sync the latest setting to channels.</span></span>

<span data-ttu-id="8e198-153">Inställningen **Kvantitet i API-utdata** innehåller tre alternativ:</span><span class="sxs-lookup"><span data-stu-id="8e198-153">The **Quantity in API output** setting provides three options:</span></span>

- <span data-ttu-id="8e198-154">**Returlagerkvantitet** – Fysiskt tillgänglig och totalt tillgänglig kvantitet för en begärd produkt returneras i API-utdatan.</span><span class="sxs-lookup"><span data-stu-id="8e198-154">**Return inventory quantity** - Physical available and total available quantity of a requested product are returned in API output.</span></span>
- <span data-ttu-id="8e198-155">**Returlagerkvantitet som subtraherar lagerbuffert** – Den kvantiteten som returneras i API-utdatan justeras genom att lagerbuffertvärdet subtraheras.</span><span class="sxs-lookup"><span data-stu-id="8e198-155">**Return inventory quantity subtracting inventory buffer** - The quantity returned in the API output is adjusted by subtracting the inventory buffer value.</span></span> <span data-ttu-id="8e198-156">Mer information om lagerbufferten finns i [Konfigurera lagerbuffertar och lagernivåer](inventory-buffers-levels.md).</span><span class="sxs-lookup"><span data-stu-id="8e198-156">For more information about the inventory buffer, see [Configure inventory buffers and inventory levels](inventory-buffers-levels.md).</span></span>
- <span data-ttu-id="8e198-157">**Ej returlagerkvantitet** – Endast lagernivån returneras i API-utdatan.</span><span class="sxs-lookup"><span data-stu-id="8e198-157">**Not return inventory quantity** - Only the inventory level is returned in the API output.</span></span> <span data-ttu-id="8e198-158">Mer information om lagerbuffertens nivåer finns i [Konfigurera lagerbuffertar och lagernivåer](inventory-buffers-levels.md).</span><span class="sxs-lookup"><span data-stu-id="8e198-158">For more information about inventory levels, see [Configure inventory buffers and inventory levels](inventory-buffers-levels.md).</span></span>

<span data-ttu-id="8e198-159">Du kan använda API-parametern `QuantityUnitTypeValue` om du vill ange den enhetstyp i vilken du vill att API:erna ska returnera kvantiteterna.</span><span class="sxs-lookup"><span data-stu-id="8e198-159">You can use the `QuantityUnitTypeValue` API parameter to specify the unit type in which you would like the APIs to return quantity.</span></span> <span data-ttu-id="8e198-160">Denna parametern stöder alternativen **Lagerenhet** (standard), **Inköpsenhet** och **Försäljningsenhet**.</span><span class="sxs-lookup"><span data-stu-id="8e198-160">This parameter supports the **inventory unit** (default), **purchase unit**, and **sell unit** options.</span></span> <span data-ttu-id="8e198-161">Den returnerade kvantiteten avrundas till den definierade precisionen för motsvarande måttenhet (UOM) i administrationen.</span><span class="sxs-lookup"><span data-stu-id="8e198-161">The returned quantity is rounded to the defined precision of the corresponding unit of measure (UOM) in headquarters.</span></span>

<span data-ttu-id="8e198-162">I API:t **GetEstimatedAvailability** finns följande inmatningsparametrar som stöder olika frågescenarier:</span><span class="sxs-lookup"><span data-stu-id="8e198-162">The **GetEstimatedAvailability** API offers the following input parameters to support different query scenarios:</span></span>

- <span data-ttu-id="8e198-163">`DefaultWarehouseOnly` – Använd den här parametern när du vill söka i lager efter en produkt i näthandelskanalens standardlagerställe.</span><span class="sxs-lookup"><span data-stu-id="8e198-163">`DefaultWarehouseOnly` - Use this parameter to query inventory for a product in the online channel's default warehouse.</span></span> 
- <span data-ttu-id="8e198-164">`FilterByChannelFulfillmentGroup` och `SearchArea` - Använd dessa två parametrar för att söka i lagret efter en produkt från alla upphämtningsställen inom ett specifikt sökområde, baserat på `longitude`, `latitude` och `radius`.</span><span class="sxs-lookup"><span data-stu-id="8e198-164">`FilterByChannelFulfillmentGroup` and `SearchArea` - Use these two parameters to query inventory for a product from all pickup locations within a specific search area, based on `longitude`, `latitude`, and `radius`.</span></span> 
- <span data-ttu-id="8e198-165">`FilterByChannelFulfillmentGroup` och `DeliveryModeTypeFilterValue` - Använd dessa två parametrar för att söka lagerstället för en produkt från specifika lagerställen som är kopplade till en onlinekanals uppfyllelsegrupp och är konfigurerade för att stödja vissa leveranssätt.</span><span class="sxs-lookup"><span data-stu-id="8e198-165">`FilterByChannelFulfillmentGroup` and `DeliveryModeTypeFilterValue` - Use these two parameters to query inventory for a product from specific warehouses that are linked to an online channel's fulfillment group and are configured to support certain modes of delivery.</span></span> <span data-ttu-id="8e198-166">Parametern `DeliveryModeTypeFilterValue` stöder alternativen **alla** (standardalternativ), **leverans** samt **upphämtning**.</span><span class="sxs-lookup"><span data-stu-id="8e198-166">The `DeliveryModeTypeFilterValue` parameter supports the **all** (default), **shipping**, and **pickup** options.</span></span> <span data-ttu-id="8e198-167">I ett scenario där en onlineorder kan uppfyllas från flera leveranslagerställen kan du till exempel använda dessa två parametrar för att fråga efter en produkts lagertillgänglighet i alla dessa leveranslagerställen.</span><span class="sxs-lookup"><span data-stu-id="8e198-167">For example, in a scenario where an online order can be fulfilled from multiple shipping warehouses, you can use these two parameters to query a product's inventory availability in all of those shipping warehouses.</span></span> <span data-ttu-id="8e198-168">API:t i det här fallet returnerar produktens lagerbehållningskvantitet och lagernivå i varje leveranslagerställe, plus en aggregerad kvantitet och en aggregerad lagernivå från alla leveranslagerställen i frågesomfång.</span><span class="sxs-lookup"><span data-stu-id="8e198-168">The API in this case returns the product's on-hand quantity and inventory level in each of the shipping warehouses, plus an aggregated quantity and an aggregated inventory level from all shipping warehouses in the query scope.</span></span>
 
<span data-ttu-id="8e198-169">Inköpsruta, butiksväljare, önskelista, kundvagn och kundvagnsikon för Commerce förbrukar de API:er och parametrar som omnämns ovan i syfte att visa meddelanden om lagernivåer på hela näthandelssajten.</span><span class="sxs-lookup"><span data-stu-id="8e198-169">The Commerce buy box, store selector, wishlist, cart, and cart icon modules consume the APIs and parameters mentioned above to display inventory level messages across the e-commerce site.</span></span> <span data-ttu-id="8e198-170">ommerce-webbplatsbyggaren innehåller olika lagerinställningar som styr marknadsföring och inköp.</span><span class="sxs-lookup"><span data-stu-id="8e198-170">Commerce site builder provides various inventory settings to control merchandising and purchase behavior.</span></span> <span data-ttu-id="8e198-171">Mer information om [Använd lagerinställningar](inventory-settings.md).</span><span class="sxs-lookup"><span data-stu-id="8e198-171">For more information, see [Apply inventory settings](inventory-settings.md).</span></span>

## <a name="pos-inventory-lookup-with-channel-side-calculation"></a><span data-ttu-id="8e198-172">Sökning efter kassalager med beräkning på kanalsidan</span><span class="sxs-lookup"><span data-stu-id="8e198-172">POS inventory lookup with channel-side calculation</span></span>

<span data-ttu-id="8e198-173">I Commerce version 10.0.9 och tidigare använde funktionen **Lagersökning** i kassan (POS) ett serviceanrop i realtid i syfte att hämta lagerinformation för vald produkt för såväl användarens aktuella butik och alla andra eventuella butiker som har konfigurerats för uppfyllelsegruppen som ett led i kanalfigurationen för butiken.</span><span class="sxs-lookup"><span data-stu-id="8e198-173">In the Commerce release 10.0.9 and earlier, the **Inventory lookup** operation in POS used a real-time service call to headquarters to get inventory information for the selected product for both the user's current store and any other stores that are configured for the fulfillment group as part of the channel configuration for the store.</span></span> <span data-ttu-id="8e198-174">I Commerce version 10.0.10 och senare kan du stänga av tjänsteanrop till administrationen i realtid och istället använda beräkningar på kanalsidan på Commerce-servern för att bestämma vilken lagerbehållning som är fysiskt tillgänglig för butiken och alla andra platser som har definierats i uppfyllelsegruppen.</span><span class="sxs-lookup"><span data-stu-id="8e198-174">In Commerce release 10.0.10 and later, you can turn off real-time service calls to headquarters and instead use channel-side calculation on the Commerce server to determine the on-hand inventory that is physically available for the store and any other locations that are defined in the fulfillment group.</span></span> <span data-ttu-id="8e198-175">Denna kanalberäknade lagerkonfiguration är också användbar för platser där Internet-anslutningen är otillförlitlig, detta eftersom du inte behöver vara online för att hämta lagersökningar från administrationen.</span><span class="sxs-lookup"><span data-stu-id="8e198-175">This channel-calculated inventory configuration is also useful for locations where internet connectivity is unreliable, because you don't have to be online to get inventory lookups headquarters.</span></span>

<span data-ttu-id="8e198-176">När kanalsidans beräkning är korrekt konfigurerad och hanterad kan den ge en mer tillförlitlig uppskattning av den aktuella butiksinventeringen, detta eftersom den använder de transaktionsdata som finns i Commerce-kanaldatabasen men som administrationen kanske ännu inte har information om.</span><span class="sxs-lookup"><span data-stu-id="8e198-176">When channel-side calculation is correctly configured and managed, it can provide a more reliable estimate of the current store inventory because it uses the transactional data that is in the Commerce channel database but that headquarters might not yet have information about.</span></span> <span data-ttu-id="8e198-177">Om du till exempel använder det befintliga serviceanropet i realtid för lagersökningar i kassan (POS) har administrationen antagligen ingen information om hämtköpförsäljning som har utförts för en produkt.</span><span class="sxs-lookup"><span data-stu-id="8e198-177">For example, if you use the existing real-time service call for inventory lookups in POS, headquarters probably won't yet have information about a cash-and-carry sale that just occurred for a product.</span></span> <span data-ttu-id="8e198-178">Det lagerbehållningsvärde som administrationen returnerar för den produkten kommer därför troligen att överskrida butikens faktiska lagerbehållning med en enhet.</span><span class="sxs-lookup"><span data-stu-id="8e198-178">Therefore, the on-hand inventory value that headquarters returns for that product will probably exceed the store's actual on-hand inventory by one unit.</span></span> <span data-ttu-id="8e198-179">Om du däremot använder beräkning på kanalsidan kan hämtköpförsäljning delas upp i beräkningen och dras av från behållningsvärdet som visas.</span><span class="sxs-lookup"><span data-stu-id="8e198-179">However, if you use channel-side calculation, the cash-and-carry sale can be factored into the calculation and deducted from the on-hand value that is shown.</span></span> <span data-ttu-id="8e198-180">Även om de värden som används vid beräkningen av både kanalsidan och servicesamtalet i realtid är enbart uppskattningar av lagerbehållning, är värdet som beräkningen på kanalsidan ger mycket mer exakt för den aktuella butiken.</span><span class="sxs-lookup"><span data-stu-id="8e198-180">Although the values that both the channel-side calculation and the real-time service call provide are only estimates of on-hand inventory, the value that the channel-side calculation provides is much more likely to be accurate for the current store.</span></span>

<span data-ttu-id="8e198-181">Följ de här stegen om du vill konfigurera kassafunktionen (POS) **Säkerhetskopiera lager** i syfte att använda beräkningslogiken på kanalsidan och stänga av serviceanrop i realtid.</span><span class="sxs-lookup"><span data-stu-id="8e198-181">To configure the POS **Inventory lookup** operation in headquarters to use the channel-side calculation logic and turn off real-time service call, follow these steps.</span></span>

1. <span data-ttu-id="8e198-182">Gå till **Retail and Commerce \> Kanalinställningar \> Kassainställningar \> Kassaprofiler \> Funktionsprofiler**.</span><span class="sxs-lookup"><span data-stu-id="8e198-182">Go to **Retail and Commerce \> Channel setup \> POS setup \> POS profiles \> Functionality profiles**.</span></span>
1. <span data-ttu-id="8e198-183">Välj en funktionsprofil.</span><span class="sxs-lookup"><span data-stu-id="8e198-183">Select a functionality profile.</span></span>
1. <span data-ttu-id="8e198-184">På snabbfliken **Funktioner**, i avsnittet **Beräkning av lagertillgänglighet**, ändrar du värdet för **Beräkningsvärde för lagertillgänglighet** från **Realtidstjänst** till **Kanal**.</span><span class="sxs-lookup"><span data-stu-id="8e198-184">On the **Functions** FastTab, in the **Inventory availability calculation** section, change the value of **Inventory availability calculation mode** from **Real time service** to **Channel**.</span></span> <span data-ttu-id="8e198-185">Alla funktionsprofiler använder som standard servicesamtal i realtid.</span><span class="sxs-lookup"><span data-stu-id="8e198-185">By default, all functionality profiles use real-time service calls.</span></span> <span data-ttu-id="8e198-186">Du måste ändra värdet i det här fältet om du vill använda beräkningslogik på kanalsidan.</span><span class="sxs-lookup"><span data-stu-id="8e198-186">You must change the value of this field if you want to use channel-side calculation logic.</span></span> <span data-ttu-id="8e198-187">Alla butiker som är kopplade till den valda funktionsprofilen påverkas av den här ändringen.</span><span class="sxs-lookup"><span data-stu-id="8e198-187">Every retail store that is linked to the selected functionality profile will be affected by this change.</span></span>

<span data-ttu-id="8e198-188">Du måste sedan synkronisera ändringarna till kanalen genom distributionsschemaprocessen i administrationen genom att utföra följande steg:</span><span class="sxs-lookup"><span data-stu-id="8e198-188">You must then sync the changes to the channels through the distribution schedule process in headquarters by following these steps.</span></span>

1. <span data-ttu-id="8e198-189">Gå till **Retail and Commerce \> Retail and Commerce-IT \> Distributionsschema**.</span><span class="sxs-lookup"><span data-stu-id="8e198-189">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="8e198-190">Kör jobbet **1070** (**jakanlkonfiguration**).</span><span class="sxs-lookup"><span data-stu-id="8e198-190">Run the **1070** (**Channel configuration**) job.</span></span>

<span data-ttu-id="8e198-191">När konfigurationen är klar använder den information som finns om fysiskt tillgängligt lager inte längre ett samtal i realtid när en användare i kassaprogrammet använder operationen **lagersökning** (standard- och matrisvyer).</span><span class="sxs-lookup"><span data-stu-id="8e198-191">After the configuration is completed, the information that is provided about physically available inventory no longer uses a real-time service call when a user in the POS application uses the **Inventory lookup** operation (standard and matrix views).</span></span> <span data-ttu-id="8e198-192">I stället beräknas data om fysiskt tillgängligt lager för den aktuella butiken och alla butiker i uppfyllelsegruppen, baserat på den senaste kända ögonblicksbilden som levererades till kanaldatabasen från Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="8e198-192">Instead, data about physically available inventory for the current store and all the stores in the fulfillment group is calculated based on the last-known snapshot that was delivered to the channel database from Commerce Headquarters.</span></span> <span data-ttu-id="8e198-193">Värdet för ögonblicksbilden kan finjusteras ytterligare av kanalberäkningen för att justera det fysiskt tillgängliga värdet, baserat på ytterligare försäljnings- eller returtransaktioner för den valda produkten i kanaldatabasen som inte inkluderades i de senaste synkroniserad ögonblicksbilden från 1130-jobbet.</span><span class="sxs-lookup"><span data-stu-id="8e198-193">The snapshot value is further refined by the channel-side calculation to adjust the physically available value, based on additional sales or return transactions that exist for the selected product in the channel database that were not included in the last synchronized snapshot from the 1130 job.</span></span> <span data-ttu-id="8e198-194">Om kanaldatabasen inte innehåller transaktionsdata för något av lagren eller butikerna i uppfyllelsegruppen, innehåller den inga ytterligare transaktioner som kan beaktas vid en omberäkning av värdet.</span><span class="sxs-lookup"><span data-stu-id="8e198-194">If the channel database doesn't contain transactional data for any of the warehouses or stores in the fulfillment group, it contains no additional transactions that can be factored into a recalculation of the value.</span></span> <span data-ttu-id="8e198-195">Därför är den bästa uppskattningen av lagerbehållning som kan visas för dessa lagerställen eller butiker, data från den senaste ögonblicksbilden av Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="8e198-195">Therefore, the best estimate of on-hand inventory that can be shown for those warehouses or stores is the data from the last-known Commerce Headquarters snapshot.</span></span>

<span data-ttu-id="8e198-196">Skärmen **Orderuppfyllelse** i POS utnyttjar också beräkningen av kanalsidan för att visa inventering för objekt när en rad för orderuppfyllning är vald och en användare visar panelen **Detaljer** för lagerbehållning för den valda artikeln..</span><span class="sxs-lookup"><span data-stu-id="8e198-196">The **Order fulfillment** screens of POS also leverage the channel side calculation to show on-hand inventory for items when an order fulfillment line is selected and a user views the **Details** panel for on-hand inventory for the selected item.</span></span>

## <a name="optimize-your-inventory-data"></a><span data-ttu-id="8e198-197">Optimera dina lagerdata</span><span class="sxs-lookup"><span data-stu-id="8e198-197">Optimize your inventory data</span></span>

<span data-ttu-id="8e198-198">För att säkerställa bästa möjliga uppskattning av lagret är det viktigt att du använder följande Commerce-batchjobb och kör dem ofta:</span><span class="sxs-lookup"><span data-stu-id="8e198-198">To ensure the best possible estimate of inventory, it's critical that you use the following Commerce batch jobs and run them frequently:</span></span>

- <span data-ttu-id="8e198-199">**P-Jobb** – p-jobbet finns på sidan **distributionsplaner** och bör köras ofta.</span><span class="sxs-lookup"><span data-stu-id="8e198-199">**P-job** – The P-job is found on the **Distribution schedules** page and should be run frequently.</span></span> <span data-ttu-id="8e198-200">Det här jobbet ger näthandelsorder, asynkrona kundorder som skapats av POS och hämtköporder som skapas från kanaldatabaser till Commerce-administration, så att de kan bearbetas ytterligare.</span><span class="sxs-lookup"><span data-stu-id="8e198-200">This job brings e-Commerce orders, asynchronous customer orders that POS created, and cash-and-carry orders that POS created from the channel databases into Commerce Headquarters, so that they can be processed further.</span></span> <span data-ttu-id="8e198-201">Innan dessa data synkroniseras från kanalen till Commerce-administration har inte Commerce-administration någon information om lagerjusteringar till produkter i de lagerställen som kommer från dessa transaktioner.</span><span class="sxs-lookup"><span data-stu-id="8e198-201">Until this data is synced from the channel to Commerce Headquarters, Commerce Headquarters has no information about inventory adjustments to products in the warehouses that result from those transactions.</span></span>
- <span data-ttu-id="8e198-202">**Synkronisera order** – i det här jobbet bearbetas råa transaktionsdata i Commerce-administration som P-jobbet innehåller och omvandlar näthandel och asynkrona kundordertransaktioner till försäljningsorder i Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="8e198-202">**Synchronize orders** – This job processes the raw transactional data in Commerce Headquarters that the P-job provides and converts e-Commerce and asynchronous customer order transactions into sales orders in Commerce Headquarters.</span></span> <span data-ttu-id="8e198-203">Inga lagertransaktioner skapas förrän jobbet bearbetas och försäljningsorder skapas.</span><span class="sxs-lookup"><span data-stu-id="8e198-203">Until this job is processed and the sales orders are created, no inventory transactions are created.</span></span> <span data-ttu-id="8e198-204">Lagerbehållningen i Commerce-administration kan därför inte ta hänsyn till transaktionerna.</span><span class="sxs-lookup"><span data-stu-id="8e198-204">Therefore, on-hand inventory in Commerce Headquarters won't consider the transactions.</span></span>
- <span data-ttu-id="8e198-205">**Beräkna transaktionsutdrag i batch** – för hämtköpstransaktioner som skapas i butiken, säkerställer indroppningsbaserad bokföringsprocess att lagret som är relaterat till försäljningen uppdateras effektivt.</span><span class="sxs-lookup"><span data-stu-id="8e198-205">**Calculate transactional statements in batch** – For cash-and-carry transactions that are created in the store, the trickle feed posting process ensures that inventory that is related to the sales is updated efficiently.</span></span> <span data-ttu-id="8e198-206">För att få effektiv bearbetning av lagertransaktioner för hämtköpsorder måste du konfigurera systemet för att använda [indroppningsbaserad bokföring](./trickle-feed.md).</span><span class="sxs-lookup"><span data-stu-id="8e198-206">To get the most efficient processing of inventory transactions for cash-and-carry orders, make sure that you configure your system to use [trickle feed posting](./trickle-feed.md).</span></span>
- <span data-ttu-id="8e198-207">**Bokför transaktionsutdrag i batch** – det här jobbet krävs även för indroppningsbaserad bokföring.</span><span class="sxs-lookup"><span data-stu-id="8e198-207">**Post transactional statements in batch** – This job is also required for trickle feed posting.</span></span> <span data-ttu-id="8e198-208">Den följer jobbet **Beräkna transaktionsutdrag i batch**.</span><span class="sxs-lookup"><span data-stu-id="8e198-208">It follows the **Calculate transactional statements in batch** job.</span></span> <span data-ttu-id="8e198-209">Det här jobbet bokför de beräknade utdragen, så att försäljningsorder för hämtköpförsäljningen skapas i Commerce-administration och i Commerce-administration på ett mer exakt sätt återspeglar butikens lager.</span><span class="sxs-lookup"><span data-stu-id="8e198-209">This job systematically posts the calculated statements, so that sales orders for cash-and-carry sales are created in Commerce Headquarters and Commerce Headquarters more accurately reflects your store's inventory.</span></span>
- <span data-ttu-id="8e198-210">**Produkttillgänglighet** – det här jobbet skapar ögonblicksbilden av lagret från Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="8e198-210">**Product availability** – This job creates the snapshot of inventory from Commerce Headquarters.</span></span>
- <span data-ttu-id="8e198-211">**1130 (Produkttillgänglighet)** – det här jobbet finns på sidan **distributionsplaner** och bör köras omedelbart efter jobbet **produkttillgänglighet**.</span><span class="sxs-lookup"><span data-stu-id="8e198-211">**1130 (Product availability)** – This job is found on the **Distribution schedules** page and should be run immediately after the **Product availability** job.</span></span> <span data-ttu-id="8e198-212">Det här jobbet transporterar data för lagerögonblicksbilden från Commerce-administration till kanaldatabaserna.</span><span class="sxs-lookup"><span data-stu-id="8e198-212">This job transports the inventory snapshot data from Commerce Headquarters to the channel databases.</span></span>

> [!NOTE]
> - <span data-ttu-id="8e198-213">Det bästa är att köra jobben **Produkttillgänglighet** och **1130** varje timme, samt att schemalägga P-jobb, synkronisera order och "in-droppa" (trickle feed) bokföringsrelaterade jobb med samma eller högre frekvens.</span><span class="sxs-lookup"><span data-stu-id="8e198-213">It is a best practice to run the **Product availability** and **1130** jobs on an hourly basis, and to schedule P-job, synchronize orders, and trickle feed posting-related jobs with the same or higher frequency.</span></span>
> - <span data-ttu-id="8e198-214">När beräkningar för lagertillgänglighet på kanalsidan används för att skapa en begäran om lagertillgänglighet med hjälp av API:er för e-Commerce eller kassalagerlogik på kanalsidan, kommer beräkningen av prestandaskäl att använda en cache i syfte att avgöra huruvida tillräckligt med tid har passerat för att det ska vara berättigat att köra beräkningslogiken på nytt.</span><span class="sxs-lookup"><span data-stu-id="8e198-214">For performance reasons, when channel-side inventory availability calculations are used to make an inventory availability request using the e-Commerce API's or the POS channel-side inventory logic, the calculation uses a cache to determine whether enough time has passed to justify running the calculation logic again.</span></span> <span data-ttu-id="8e198-215">Standardcache är inställd på 60 sekunder.</span><span class="sxs-lookup"><span data-stu-id="8e198-215">The default cache is set to 60 seconds.</span></span> <span data-ttu-id="8e198-216">Du har till exempel aktiverat en beräkning på kanalsidan för butiken och visat lagerbehållningen för en produkt på sidan **lagersökning**.</span><span class="sxs-lookup"><span data-stu-id="8e198-216">For example, you turned on channel-side calculation for your store and viewed the on-hand inventory for a product on the **Inventory lookup** page.</span></span> <span data-ttu-id="8e198-217">Om en enhet av produkten sedan säljs kommer sidan **lagersökning** inte att visa det reducerade lagret förrän cachen har rensats.</span><span class="sxs-lookup"><span data-stu-id="8e198-217">If one unit of the product is then sold, the **Inventory lookup** page won't show the reduced inventory until the cache has been cleared.</span></span> <span data-ttu-id="8e198-218">När användarna har bokfört transaktioner i POS ska de vänta 60 sekunder innan de kontrollerar att lagerbehållningen har reducerats.</span><span class="sxs-lookup"><span data-stu-id="8e198-218">After users post transactions in POS, they should wait 60 seconds before they verify that the on-hand inventory has been reduced.</span></span>

<span data-ttu-id="8e198-219">Om ditt affärsscenario kräver en mindre cachetid kan du kontakta din produktsupportrepresentant för att få hjälp.</span><span class="sxs-lookup"><span data-stu-id="8e198-219">If your business scenario requires a smaller cache time, contact your product support representative for assistance.</span></span>


[!INCLUDE[footer-include](../includes/footer-banner.md)]
