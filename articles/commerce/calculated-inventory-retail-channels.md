---
title: Beräkna lagertillgänglighet för butikskanaler
description: I det här avsnittet beskrivs alternativen som kan användas för att visa lagerbehållningen för butiken och online-kanaler.
author: hhainesms
manager: annbe
ms.date: 08/13/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: hhaines
ms.search.validFrom: 2020-02-11
ms.dyn365.ops.version: Release 10.0.10
ms.openlocfilehash: ff60ef23c7e19e3f2f97d56fd416e0018a0c324d
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 02/15/2021
ms.locfileid: "5213268"
---
# <a name="calculate-inventory-availability-for-retail-channels"></a><span data-ttu-id="0bdc4-103">Beräkna lagertillgänglighet för butikskanaler</span><span class="sxs-lookup"><span data-stu-id="0bdc4-103">Calculate inventory availability for retail channels</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="0bdc4-104">I det här avsnittet beskrivs hur ett företag kan använda Microsoft Dynamics 365 Commerce för att visa uppskattade tillgängliga produkter i online- och butikskanaler.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-104">This topic describes how a company can use Microsoft Dynamics 365 Commerce to view estimated on-hand availability for products in the online and store channels.</span></span>

## <a name="accuracy-of-calculation"></a><span data-ttu-id="0bdc4-105">Beräkningens noggrannhet</span><span class="sxs-lookup"><span data-stu-id="0bdc4-105">Accuracy of calculation</span></span>

<span data-ttu-id="0bdc4-106">Commerce använder flera servrar och databaser för att garantera skalbarhet och prestanda.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-106">Commerce uses multiple servers and databases to ensure scalability and performance.</span></span> <span data-ttu-id="0bdc4-107">Därför är det viktigt att du förstår att de tillgängliga lagervärdet som tillhandahålls via kassaprogrammet (POS), API:er för lagertillgänglighet för näthandel och lagerbehållningssidorna i Commerce-administration kanske inte är 100 procent korrekt i realtid.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-107">Therefore, it's important that you understand that the available inventory values that are provided through the point of sale (POS) application, the e-Commerce inventory availability application programming interfaces (APIs), and the on-hand inventory pages in Commerce Headquarters might not be 100-percent accurate in real time.</span></span> <span data-ttu-id="0bdc4-108">Om transaktioner som skapas för produkter i online- eller butikskanalen ännu inte har synkroniserats till Commerce-administrationens server och databasen, kan lagerbehållningssidorna i Commerce-administration inte visa ett korrekt lager värde i realtid för dessa produkter.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-108">If transactions that are created for products in the online or store channel haven't yet been synced to the Commerce Headquarters server and database, the on-hand inventory pages in Commerce Headquarters might not show an accurate real-time inventory value for those products.</span></span> <span data-ttu-id="0bdc4-109">Om du har konfigurerat ditt företag så att användare i Commerce-administrationen eller andra integrerade program kan sälja, ta emot, returnera eller på annat sätt justera lagret från en butik eller på onlinenivå, kanske inte kassa- eller online-kanalen har all information som krävs för att visa ett korrekt lagerbehållningsvärde i realtid för artiklar.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-109">Conversely, if you configured your company so that users in Commerce Headquarters or other integrated applications can sell, receive, return, or otherwise adjust inventory out of a store or online warehouse, the POS or online channel might not have all the information that is required to show an accurate real-time on-hand value for items.</span></span>

<span data-ttu-id="0bdc4-110">I det här avsnittet beskrivs de processer för datasynkronisering som kan köras ofta för att begränsa fördröjningen av data mellan program eller kanaler.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-110">This topic explains the data synchronization processes that can be run frequently to help limit the latency of data between applications or channels.</span></span> <span data-ttu-id="0bdc4-111">Det är dock viktigt att du förstår att all tillgänglig data som ges under användningsdagen betraktas som ett uppskattat värde.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-111">However, it's critical that you understand that all on-hand availability data that is provided during the operational day is considered an estimated value.</span></span> <span data-ttu-id="0bdc4-112">Därför, om du försöker jämföra den lagerbehållningsinformation som programmet ger med verklig fysisk inventering på hyllorna, eller om du försöker jämföra de behållningsvärden som visas i POS med de data som du hittar för samma lagerställe i I Commerce-administration kan värdena skilja sig.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-112">Therefore, if you try to compare the on-hand inventory information that the application provides with actual physical inventory on the shelves, or if you try to compare the on-hand values that are shown in POS with the on-hand data that you find for the same warehouse in Commerce Headquarters, the values might differ.</span></span> <span data-ttu-id="0bdc4-113">Denna skillnad förväntas under användningsdagen och bör inte betraktas som en utleverans.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-113">This difference during the operational day is expected and should not be considered an issue.</span></span> <span data-ttu-id="0bdc4-114">Om du vill granska data och se till att de värden som finns i API:er för lagertillgänglighet och Commerce-administration matchar de faktiska fysiska enheterna som finns i butiken eller lagerhyllorna, är det bäst att göra det efter att kanal åtgärderna har stoppad för dagen och alla transaktioner har synkroniserats korrekt mellan Commerce-administration och kanalen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-114">If you want to audit data and make sure that the values that are provided in the inventory availability APIs and Commerce Headquarters match the actual physical units that you find on your store or warehouse shelves, the best time to do it is after channel operations have stopped for the day and all transactions have been correctly synced between Commerce Headquarters and the channel.</span></span>

## <a name="use-inventory-lookup-apis-for-e-commerce-inventory-availability-requests"></a><span data-ttu-id="0bdc4-115">Använd API:er för lagersökning för begäran av lagertillgänglighet för näthandel</span><span class="sxs-lookup"><span data-stu-id="0bdc4-115">Use inventory lookup APIs for e-Commerce inventory availability requests</span></span>

<span data-ttu-id="0bdc4-116">Du kan använda följande API:er för att visa lagertillgänglighet för en produkt när dina kunder handlar på en näthandelssajt.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-116">You can use the following APIs to show inventory availability for a product when your customers are shopping on an e-Commerce site.</span></span>

- <span data-ttu-id="0bdc4-117">**GetEstimatedAvailability** – Använd den här API:n för att hämta lagertillgänglighet för artikeln i näthandelskanalens lager eller alla lagerställen som är kopplade till konfigurationen av uppfyllelsegruppen för näthandelskanalen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-117">**GetEstimatedAvailability** – Use this API to get inventory availability for the item in the e-Commerce channel warehouse or all warehouses that are linked to the configuration of the fulfillment group for the e-Commerce channel.</span></span> <span data-ttu-id="0bdc4-118">Detta API kan också användas för lagerställen i ett visst sökområde eller en viss radie, baserat på longitud- och latituddata.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-118">This API can also be used for warehouses in a specific search area or radius, based on longitude and latitude data.</span></span>
- <span data-ttu-id="0bdc4-119">**GetEstimatedProductWarehouseAvailability** – Använd detta API för att begära lager för en artikel från ett visst lagerställe.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-119">**GetEstimatedProductWarehouseAvailability** – Use this API to request inventory for an item from a specific warehouse.</span></span> <span data-ttu-id="0bdc4-120">Du kan till exempel använda det för att visa lagerdispositionen i scenarier som innefattar orderupphämtning.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-120">For example, you can use it to show inventory availability in scenarios that involve order pickup.</span></span>

> [!NOTE]
> <span data-ttu-id="0bdc4-121">Dessa API:er ersätter **GetProductAvailabilities** och **GetAvailableInventoryNearby** API:er i Dynamics 365 Retail version 10.0.7 och tidigare.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-121">These APIs replace the **GetProductAvailabilities** and **GetAvailableInventoryNearby** APIs in Dynamics 365 Retail version 10.0.7 and earlier.</span></span>

<span data-ttu-id="0bdc4-122">Båda API:er hämtar data från Commerce Server och tillhandahåller en uppskattning av lagerbehållningen för en viss kombination av produkt- eller produktvarianten och ett lagerställe.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-122">Both APIs fetch data from the Commerce server and provide an estimate of on-hand inventory for a specific combination of a product or product variant and a warehouse.</span></span> <span data-ttu-id="0bdc4-123">Även om andra API:er som är tillgängliga på Commerce Server kan gå direkt till Commerce-administration för att hämta behållning för produkter, rekommenderar vi inte att de används i en näthandelsmiljö på grund av potentiella prestandaproblem och relaterad påverkan som dessa frekventa förfrågningar kan ha på dina servrar för Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-123">Although other APIs that are available on the Commerce server can go directly to Commerce Headquarters to fetch on-hand quantities for products, we don't recommend that they be used in an e-Commerce environment because of potential performance issues and the related impact that these frequent requests can have on your Commerce Headquarters servers.</span></span> <span data-ttu-id="0bdc4-124">Vidare om lagerbehållningen beräknas genom Commerce Server, är beräkningen mer sannolikt att inkludera lager som såldes i de senaste näthandelstransaktionerna som ännu inte har synkroniserats med Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-124">Additionally, if the on-hand inventory is calculated through the Commerce server, the calculation is more likely to include inventory that was sold in recent e-Commerce transactions that haven't yet been synced to Commerce Headquarters.</span></span> <span data-ttu-id="0bdc4-125">Även om det kanske inte finns någon information om dessa transaktioner i Commerce-administration har Commerce Server och kanaldatabasdata.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-125">Although Commerce Headquarters might not have information about these transactions, the Commerce server and channel database have the data.</span></span> <span data-ttu-id="0bdc4-126">Data kommer därför att bedömas i och kan ge en mer korrekt uppskattning av produktens tillgängliga lager.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-126">Therefore, the data will be factored in and can help provide a more accurate estimate of a product's available inventory.</span></span>

### <a name="get-started-with-e-commerce-calculated-inventory-availability"></a><span data-ttu-id="0bdc4-127">Komma igång med beräknad lagertillgänglighet för näthandel</span><span class="sxs-lookup"><span data-stu-id="0bdc4-127">Get started with e-Commerce calculated inventory availability</span></span>

<span data-ttu-id="0bdc4-128">Innan du använder de två API:er som nämnts tidigare måste du aktivera funktionen **Optimerad beräkning för produkttillgänglighet** via arbetsytan **Funktionshantering** i Commerce Headquarters.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-128">Before you use the two APIs that were mentioned earlier, you must enable the **Optimized product availability calculation** feature through the **Feature management** workspace in Commerce Headquarters.</span></span>

<span data-ttu-id="0bdc4-129">Innan API:erna kan beräkna den bästa uppskattningen av lagertillgänglighet för en artikel, måste en periodisk ögonblicksbild av lagertillgänglighet från Commerce-administration bearbetas och skickas till den kanaldatabas som näthandel Commerce Scale Unit använder.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-129">Before the APIs can calculate the best estimate of inventory availability for an item, a periodic snapshot of inventory availability from Commerce Headquarters must be processed and sent to the channel database that the e-Commerce Commerce Scale Unit uses.</span></span> <span data-ttu-id="0bdc4-130">Ögonblicksbilden representerar den information som Commerce-administration har om lagertillgänglighet för en specifik kombination av en produkt- eller produktvarianten och ett lagerställe.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-130">The snapshot represents the information that Commerce Headquarters has about inventory availability for a specific combination of a product or product variant and a warehouse.</span></span> <span data-ttu-id="0bdc4-131">Den kan omfatta lagerjusteringar eller rörelser som orsakas av lagerinleveranser, försändelser eller andra processer som utförs i Commerce-administration och som näthandelskanalen har information om endast på grund av synkroniseringsprocessen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-131">It can include inventory adjustments or movements that are caused by inventory receipts, or by shipments or other processes that are performed in Commerce Headquarters and that the e-Commerce channel has information about only because of the synchronization process.</span></span>

<span data-ttu-id="0bdc4-132">Den gonblicksbild för databas som jobbet **produkttillgänglighet** beräknar bara de lagertransaktioner som har bearbetats och bokförts i Commerce-administration vid den tidpunkt då ögonblicksbilden togs.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-132">The database snapshot that the **Product availability** job creates calculates only the inventory transactions that were processed and posted in Commerce Headquarters at the time when the snapshot was taken.</span></span> <span data-ttu-id="0bdc4-133">Om lagret såldes för en produkt i ett butikslager med hämtköp eller asynkron försäljning av kundorder i kassaprogrammet, finns det inte omedelbar information om den relaterade lagerkvantiteten för försäljningen i Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-133">If inventory was sold for a product in a store warehouse through a cash-and-carry or asynchronous customer order sale in the POS application, Commerce Headquarters won't immediately have information about the related inventory issue transaction for the sale.</span></span> <span data-ttu-id="0bdc4-134">Det kommer att ha information om lagret som säljs för dessa typer av butiksförsäljning först när P-jobbet överför den relaterade transaktionen från butikens kanaldatabas till Commerce-administration och den relaterade försäljningsordern skapas genom utdraget bokföring av bokföringsprocessen för indroppning.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-134">It will have information about the inventory that is sold for these types of store sales only after the P-job uploads the related transaction from the store's channel database into Commerce Headquarters and the related sales order is created through statement posting or the trickle feed posting processes.</span></span> <span data-ttu-id="0bdc4-135">När ordern skapas i Commerce-administration skapas relaterade lagertransaktioner.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-135">The process of creating the order in Commerce Headquarters creates the related inventory transactions.</span></span> <span data-ttu-id="0bdc4-136">För näthandelskanalorder har Commerce-administration information om lagertransaktionerna först när transaktionerna har skickats till Commerce-administration via P-projektet och synkroniseringen av ordern har slutförts.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-136">For e-Commerce channel orders, Commerce Headquarters has information about the inventory transactions only after the transactions are sent to Commerce Headquarters through the P-job and the order synchronization process is completed.</span></span> <span data-ttu-id="0bdc4-137">Därför är det viktigt att du inser att lagrets ögonblicksbildsvärde som finns i jobbet **produkttillgänglighets** inte är 100-procent korrekt i realtid på grund av den konstanta försäljningsprocessen som sker mellan distribuerade servrar.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-137">Therefore, it's important that you understand that the inventory snapshot value that is provided in the **Product availability** job might not be 100-percent accurate in real time because of the constant sales processing that occurs across distributed servers.</span></span>

<span data-ttu-id="0bdc4-138">Följ de här stegen om du vill ta en ögonblicksbild av lagret i Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-138">To take a snapshot of inventory in Commerce Headquarters, follow these steps.</span></span>

1. <span data-ttu-id="0bdc4-139">Gå till **Retail och Commerce \> Retail och Commerce IT \> Produkter och lager \> Produkttillgänglighet**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-139">Go to **Retail and Commerce \> Retail and Commerce IT \> Products and inventory \> Product availability**.</span></span>
1. <span data-ttu-id="0bdc4-140">Välj **OK** för att köra jobbet **Produkttillgänglighet**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-140">Select **OK** to run the **Product availability** job.</span></span> <span data-ttu-id="0bdc4-141">Du kan även tidsplanera det här jobbet så att det körs i en batch.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-141">You can also schedule this job so that it's run in a batch.</span></span>

<span data-ttu-id="0bdc4-142">När jobbet **produkttillgänglighet** har slutförts måste de data som fångades skickas till näthandelskanalens databaser, så att den senaste lagringsbilden för Commerce-administration kan övervägas vid beräkningen av uppskattad lagerhållning.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-142">After the **Product availability** job has finished running, the data that was captured must be pushed to the e-Commerce channel databases, so that the latest Commerce Headquarters inventory snapshot can be considered in the calculation of estimated on-hand inventory.</span></span>

1. <span data-ttu-id="0bdc4-143">Gå till **Butik och handel \> Butik och handel-IT \> Distributionsschema**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-143">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="0bdc4-144">Kör jobbet **1130** (**produkttillgänglighet**) om du vill synkronisera data för ögonblicksbild **produkttillgänglighet** har skapats från Commerce-administration till kanaldatabaserna.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-144">Run the **1130** (**Product availability**) job to sync the snapshot data that the **Product availability** job created from Commerce Headquarters to your channel databases.</span></span>

<span data-ttu-id="0bdc4-145">När lagertillgängligheten begärs från API **GetEstimatedAvailability** eller **GetEstimatedProductWarehouseAvailability** körs en beräkning för att försöka få bästa möjliga uppskattning av lagret för produkten.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-145">When inventory availability is requested from the **GetEstimatedAvailability** or **GetEstimatedProductWarehouseAvailability** API, a calculation is run to try to get the best possible estimate of inventory for the product.</span></span> <span data-ttu-id="0bdc4-146">Beräkningen hänvisar till alla kundorder för näthandel som finns i kanaldatabasen, men den togs inte med i ögonblicksbilden av de data som 1130-jobbet tillhandahåller.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-146">The calculation references any e-Commerce customer orders that are in the channel database but that weren't included in the snapshot data that the 1130 job provided.</span></span> <span data-ttu-id="0bdc4-147">Den här logiken utförs genom att den senast bearbetade lagertransaktionen spåras från Commerce-administration och jämförs med transaktionerna i kanaldatabasen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-147">This logic is performed by tracking the last processed inventory transaction from Commerce Headquarters and comparing it with the transactions in the channel database.</span></span> <span data-ttu-id="0bdc4-148">Den tillhandahåller en baslinje för beräkningslogiken för kanalsidan, så att de ytterligare lagerrörelser som inträffat för kundorder försäljningstransaktioner i näthandels kanaldatabas kan delas upp i det uppskattade lagervärdet som API:n kan.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-148">It provides a baseline for the channel-side calculation logic, so that the additional inventory movements that occurred for customer order sales transactions in the e-Commerce channel database can be factored into the estimated inventory value that the API provides.</span></span>

<span data-ttu-id="0bdc4-149">Beräkningslogiken på kanalsidan returnerar ett uppskattat fysiskt tillgängligt värde och ett totalt tillgängligt värde för den begärda produkten och lagerstället.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-149">The channel-side calculation logic returns an estimated physically available value and a total available value for the requested product and warehouse.</span></span> <span data-ttu-id="0bdc4-150">Värdena kan visas på din näthandelssajt om du vill det, eller så kan de användas för att utlösa annan affärslogik på din näthandelssajt.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-150">The values can be shown on your e-Commerce site if you want, or they can be used to trigger other business logic on your e-Commerce site.</span></span> <span data-ttu-id="0bdc4-151">Du kan till exempel visa meddelandet "brist på lager" i stället för den faktiska behållningskvantiteten som har godkänt API.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-151">For example, you can show an "out of stock" message instead of the actual on-hand quantity that the API passed.</span></span>

<span data-ttu-id="0bdc4-152">Den beräkningslogik som används för API:er för näthandelskanaler för uppskattat lagervärde kan endast utvärdera lager baserat på kundorder som har skapats i kanaldatabasen, men som ännu inte har synkroniserats och bokförts i Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-152">The calculation logic that the channel-side e-Commerce APIs use for the estimated inventory value can evaluate inventory based only on customer orders that have been created in the channel database but that haven't yet been synced and posted in Commerce Headquarters.</span></span> <span data-ttu-id="0bdc4-153">Om din kanaldatabas också innehåller transaktionsdata för hämtköpförsäljning för butiksspecifika lager, bearbetas inte hämtköpförsäljningen i kanalsidans näthandelsberäkning för dessa lagerställen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-153">If your channel database also contains transactional data for cash-and-carry sales for store-specific warehouses, the cash-and-carry sales aren't factored into the channel-side e-Commerce calculation for those warehouses.</span></span>

## <a name="configure-the-inventory-lookup-operation-in-the-pos-channel"></a><span data-ttu-id="0bdc4-154">Konfigurera sökåtgärder för lager i kassakanalen</span><span class="sxs-lookup"><span data-stu-id="0bdc4-154">Configure the inventory lookup operation in the POS channel</span></span>

<span data-ttu-id="0bdc4-155">I Retail version 10.0.9 och tidigare använder åtgärden **Lagersökning** från POS ett servicesamtal i realtid till Commerce-administration för att få lagerinformation för den valda produkten, både för användarens aktuella butik och alla andra butiker som konfigurerats för uppfyllelsegrupp som en del av kanalkonfigurationen för butiken.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-155">In Retail version 10.0.9 and earlier, the **Inventory lookup** operation from POS used a real-time service call to Commerce Headquarters to get inventory information for the selected product, for both the user's current store and any other stores that are configured for the fulfillment group as part of the channel configuration for the store.</span></span> <span data-ttu-id="0bdc4-156">I Commerce version 10.0.10 och senare kan du inaktivera servicesamtal i realtid till Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-156">In Commerce version 10.0.10 and later, you can turn off real-time service calls to Commerce Headquarters.</span></span> <span data-ttu-id="0bdc4-157">Istället kan du använda beräkning på kanalsidan på Commerce Server för att fastställa vilken lagerbehållning som är fysiskt tillgänglig för butiken och andra platser som har definierats i uppfyllelsegruppen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-157">Instead, you can use channel-side calculation on the Commerce server to determine the on-hand inventory that is physically available for the store and any other locations that are defined in the fulfillment group.</span></span> <span data-ttu-id="0bdc4-158">Denna kanalberäknade lagerkonfiguration är också användbar för platser där Internet-anslutningen är otillförlitlig, eftersom du inte behöver vara online för att hämta lagersökningar från Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-158">This channel-calculated inventory configuration is also useful for locations where internet connectivity is unreliable, because you don't have to be online to get inventory lookups from Commerce Headquarters.</span></span>

<span data-ttu-id="0bdc4-159">När kanalsidans beräkning är korrekt konfigurerad och hanterad kan den ge en mer tillförlitlig uppskattning av den aktuella butiksinventeringen, eftersom den använder de transaktionsdata som finns i Commerce-kanaldatabasen, men det kan hända att Commerce-administration ännu inte ha information om.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-159">When channel-side calculation is correctly configured and managed, it can provide a more reliable estimate of the current store inventory, because it uses the transactional data that is in the Commerce channel database but that Commerce Headquarters might not yet have information about.</span></span> <span data-ttu-id="0bdc4-160">Om du till exempel använder det befintliga servicesamtalet i realtid för lagersökningar i POS, har Commerce-administration antagligen ingen information om hämtköpförsäljning som har utförts för en produkt.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-160">For example, if you use the existing real-time service call for inventory lookups in POS, Commerce Headquarters probably won't yet have information about a cash-and-carry sale that just occurred for a product.</span></span> <span data-ttu-id="0bdc4-161">Det lagerbehållningsvärde som återkommer för den produkten kommer därför att överskrida butikens faktiska lagerbehållning med en enhet.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-161">Therefore, the on-hand inventory value that Commerce Headquarters returns for that product will probably exceed the store's actual on-hand inventory by one unit.</span></span> <span data-ttu-id="0bdc4-162">Om du däremot använder beräkning på kanalsidan kan hämtköpförsäljning delas upp i beräkningen och dras av från behållningsvärdet som visas.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-162">However, if you use channel-side calculation, the cash-and-carry sale can be factored into the calculation and deducted from the on-hand value that is shown.</span></span> <span data-ttu-id="0bdc4-163">Även om de värden som används vid beräkningen av både kanalsidan och servicesamtalet i realtid är enbart uppskattningar av lagerbehållning, är värdet som beräkningen på kanalsidan ger mycket mer exakt för den aktuella butiken.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-163">Although the values that both the channel-side calculation and the real-time service call provide are only estimates of on-hand inventory, the value that the channel-side calculation provides is much more likely to be accurate for the current store.</span></span>

### <a name="get-started-with-pos-channel-side-calculated-inventory-availability"></a><span data-ttu-id="0bdc4-164">Komma igång med beräknad lagertillgänglighet för kassa på kanalsida</span><span class="sxs-lookup"><span data-stu-id="0bdc4-164">Get started with POS channel-side calculated inventory availability</span></span>

<span data-ttu-id="0bdc4-165">Om du vill använda beräkningslogiken på kanalsidan och inaktivera serviceanrop i realtid för lagersökningar från kassaprogrammet (POS) måste du först aktivera funktionen **Optimerad beräkning för produkttillgänglighet** via arbetsytan **Funktionshantering** i Commerce Headquarters.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-165">To use the channel-side calculation logic and turn off real-time service calls for inventory lookups from the POS application, you must first enable the **Optimized product availability calculation** feature through the **Feature management** workspace in Commerce Headquarters.</span></span> <span data-ttu-id="0bdc4-166">Förutom att aktivera funktionen måste du utföra ändringar i **Funktionsprofilen**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-166">In addition to enabling the feature, you must make changes to the **Functionality profile**.</span></span>

<span data-ttu-id="0bdc4-167">Följ dessa steg för att ändra **Funktionsprofilen**:</span><span class="sxs-lookup"><span data-stu-id="0bdc4-167">To change the **Functionality profile**, follow these steps:</span></span>

1. <span data-ttu-id="0bdc4-168">Gå till **Butik och handel \> Kanalinställningar \> Kassainställningar \> Kassaprofiler \> Funktionsprofiler**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-168">Go to **Retail and Commerce \> Channel setup \> POS setup \> POS profiles \> Functionality profiles**.</span></span>
1. <span data-ttu-id="0bdc4-169">Välj en funktionsprofil.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-169">Select a functionality profile.</span></span>
1. <span data-ttu-id="0bdc4-170">På snabbfliken **funktioner** i avsnittet **Beräkning av lagertillgänglighet**, ändra värdet för fältet **Läget beräkning av lagertillgänglighet** från **Realtidstjänst** till **Kanal**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-170">On the **Functions** FastTab, in the **Invent availability calculation** section, change the value of the **Invent availability calculation mode** field from **Real time service** to **Channel**.</span></span> <span data-ttu-id="0bdc4-171">Alla funktionsprofiler använder som standard servicesamtal i realtid.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-171">By default, all functionality profiles use real-time service calls.</span></span> <span data-ttu-id="0bdc4-172">Därför måste du ändra värdet i det här fältet om du vill använda beräkningslogik på kanalsidan.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-172">Therefore, you must change the value of this field if you want to use channel-side calculation logic.</span></span> <span data-ttu-id="0bdc4-173">Alla butiker som är kopplade till den valda funktionsprofilen påverkas av den här ändringen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-173">Every retail store that is linked to the selected functionality profile will be affected by this change.</span></span>

<span data-ttu-id="0bdc4-174">Du måste sedan synkronisera ändringarna till kanalen genom distributionsschemaprocessen genom att utföra följande steg:</span><span class="sxs-lookup"><span data-stu-id="0bdc4-174">You must then sync the changes to the channel through the distribution schedule process by performing the following steps:</span></span>

1. <span data-ttu-id="0bdc4-175">Gå till **Butik och handel \> Butik och handel-IT \> Distributionsschema**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-175">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="0bdc4-176">Kör jobbet **1070** (**jakanlkonfiguration**).</span><span class="sxs-lookup"><span data-stu-id="0bdc4-176">Run the **1070** (**Channel configuration**) job.</span></span>

<span data-ttu-id="0bdc4-177">När konfigurationen är klar använder den information som finns om fysiskt tillgängligt lager inte längre ett samtal i realtid när en användare i kassaprogrammet använder operationen **lagersökning** (standard- och matrisvyer).</span><span class="sxs-lookup"><span data-stu-id="0bdc4-177">After the configuration is completed, the information that is provided about physically available inventory no longer uses a real-time service call when a user in the POS application uses the **Inventory lookup** operation (standard and matrix views).</span></span> <span data-ttu-id="0bdc4-178">I stället beräknas data om fysiskt tillgängligt lager för den aktuella butiken och alla butiker i uppfyllelsegruppen, baserat på den senaste kända ögonblicksbilden som levererades till kanaldatabasen från Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-178">Instead, data about physically available inventory for the current store and all the stores in the fulfillment group is calculated based on the last-known snapshot that was delivered to the channel database from Commerce Headquarters.</span></span> <span data-ttu-id="0bdc4-179">Värdet för ögonblicksbilden kan finjusteras ytterligare av kanalberäkningen för att justera det fysiskt tillgängliga värdet, baserat på ytterligare försäljnings- eller returtransaktioner för den valda produkten i kanaldatabasen som inte inkluderades i de senaste synkroniserad ögonblicksbilden från 1130-jobbet.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-179">The snapshot value is further refined by the channel-side calculation to adjust the physically available value, based on additional sales or return transactions that exist for the selected product in the channel database that were not included in the last synchronized snapshot from the 1130 job.</span></span> <span data-ttu-id="0bdc4-180">Om kanaldatabasen inte innehåller transaktionsdata för något av lagren eller butikerna i uppfyllelsegruppen, innehåller den inga ytterligare transaktioner som kan beaktas vid en omberäkning av värdet.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-180">If the channel database doesn't contain transactional data for any of the warehouses or stores in the fulfillment group, it contains no additional transactions that can be factored into a recalculation of the value.</span></span> <span data-ttu-id="0bdc4-181">Därför är den bästa uppskattningen av lagerbehållning som kan visas för dessa lagerställen eller butiker, data från den senaste ögonblicksbilden av Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-181">Therefore, the best estimate of on-hand inventory that can be shown for those warehouses or stores is the data from the last-known Commerce Headquarters snapshot.</span></span>

<span data-ttu-id="0bdc4-182">Skärmen **Orderuppfyllelse** i POS utnyttjar också beräkningen av kanalsidan för att visa inventering för objekt när en rad för orderuppfyllning är vald och en användare visar panelen **Detaljer** för lagerbehållning för den valda artikeln..</span><span class="sxs-lookup"><span data-stu-id="0bdc4-182">The **Order fulfillment** screens of POS also leverage the channel side calculation to show on-hand inventory for items when an order fulfillment line is selected and a user views the **Details** panel for on-hand inventory for the selected item.</span></span>

## <a name="optimize-your-inventory-data"></a><span data-ttu-id="0bdc4-183">Optimera dina lagerdata</span><span class="sxs-lookup"><span data-stu-id="0bdc4-183">Optimize your inventory data</span></span>

<span data-ttu-id="0bdc4-184">För att säkerställa bästa möjliga uppskattning av lagret är det viktigt att du använder följande Commerce-batchjobb och kör dem ofta:</span><span class="sxs-lookup"><span data-stu-id="0bdc4-184">To ensure the best possible estimate of inventory, it's critical that you use the following Commerce batch jobs and run them frequently:</span></span>

- <span data-ttu-id="0bdc4-185">**P-Jobb** – p-jobbet finns på sidan **distributionsplaner** och bör köras ofta.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-185">**P-job** – The P-job is found on the **Distribution schedules** page and should be run frequently.</span></span> <span data-ttu-id="0bdc4-186">Det här jobbet ger näthandelsorder, asynkrona kundorder som skapats av POS och hämtköporder som skapas från kanaldatabaser till Commerce-administration, så att de kan bearbetas ytterligare.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-186">This job brings e-Commerce orders, asynchronous customer orders that POS created, and cash-and-carry orders that POS created from the channel databases into Commerce Headquarters, so that they can be processed further.</span></span> <span data-ttu-id="0bdc4-187">Innan dessa data synkroniseras från kanalen till Commerce-administration har inte Commerce-administration någon information om lagerjusteringar till produkter i de lagerställen som kommer från dessa transaktioner.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-187">Until this data is synced from the channel to Commerce Headquarters, Commerce Headquarters has no information about inventory adjustments to products in the warehouses that result from those transactions.</span></span>
- <span data-ttu-id="0bdc4-188">**Synkronisera order** – i det här jobbet bearbetas råa transaktionsdata i Commerce-administration som P-jobbet innehåller och omvandlar näthandel och asynkrona kundordertransaktioner till försäljningsorder i Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-188">**Synchronize orders** – This job processes the raw transactional data in Commerce Headquarters that the P-job provides and converts e-Commerce and asynchronous customer order transactions into sales orders in Commerce Headquarters.</span></span> <span data-ttu-id="0bdc4-189">Inga lagertransaktioner skapas förrän jobbet bearbetas och försäljningsorder skapas.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-189">Until this job is processed and the sales orders are created, no inventory transactions are created.</span></span> <span data-ttu-id="0bdc4-190">Lagerbehållningen i Commerce-administration kan därför inte ta hänsyn till transaktionerna.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-190">Therefore, on-hand inventory in Commerce Headquarters won't consider the transactions.</span></span>
- <span data-ttu-id="0bdc4-191">**Beräkna transaktionsutdrag i batch** – för hämtköpstransaktioner som skapas i butiken, säkerställer indroppningsbaserad bokföringsprocess att lagret som är relaterat till försäljningen uppdateras effektivt.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-191">**Calculate transactional statements in batch** – For cash-and-carry transactions that are created in the store, the trickle feed posting process ensures that inventory that is related to the sales is updated efficiently.</span></span> <span data-ttu-id="0bdc4-192">För att få effektiv bearbetning av lagertransaktioner för hämtköpsorder måste du konfigurera systemet för att använda [indroppningsbaserad bokföring](https://docs.microsoft.com/dynamics365/commerce/trickle-feed).</span><span class="sxs-lookup"><span data-stu-id="0bdc4-192">To get the most efficient processing of inventory transactions for cash-and-carry orders, make sure that you configure your system to use [trickle feed posting](https://docs.microsoft.com/dynamics365/commerce/trickle-feed).</span></span>
- <span data-ttu-id="0bdc4-193">**Bokför transaktionsutdrag i batch** – det här jobbet krävs även för indroppningsbaserad bokföring.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-193">**Post transactional statements in batch** – This job is also required for trickle feed posting.</span></span> <span data-ttu-id="0bdc4-194">Den följer jobbet **Beräkna transaktionsutdrag i batch**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-194">It follows the **Calculate transactional statements in batch** job.</span></span> <span data-ttu-id="0bdc4-195">Det här jobbet bokför de beräknade utdragen, så att försäljningsorder för hämtköpförsäljningen skapas i Commerce-administration och i Commerce-administration på ett mer exakt sätt återspeglar butikens lager.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-195">This job systematically posts the calculated statements, so that sales orders for cash-and-carry sales are created in Commerce Headquarters and Commerce Headquarters more accurately reflects your store's inventory.</span></span>
- <span data-ttu-id="0bdc4-196">**Produkttillgänglighet** – det här jobbet skapar ögonblicksbilden av lagret från Commerce-administration.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-196">**Product availability** – This job creates the snapshot of inventory from Commerce Headquarters.</span></span>
- <span data-ttu-id="0bdc4-197">**1130 (Produkttillgänglighet)** – det här jobbet finns på sidan **distributionsplaner** och bör köras omedelbart efter jobbet **produkttillgänglighet**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-197">**1130 (Product availability)** – This job is found on the **Distribution schedules** page and should be run immediately after the **Product availability** job.</span></span> <span data-ttu-id="0bdc4-198">Det här jobbet transporterar data för lagerögonblicksbilden från Commerce-administration till kanaldatabaserna.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-198">This job transports the inventory snapshot data from Commerce Headquarters to the channel databases.</span></span>

<span data-ttu-id="0bdc4-199">Vi rekommenderar att du inte kör dessa batchjobb för ofta (med några minuters intervall).</span><span class="sxs-lookup"><span data-stu-id="0bdc4-199">It's recommended that you don't run those batch jobs too frequently (every few minutes).</span></span> <span data-ttu-id="0bdc4-200">Att köra ofta överbelastar Commerce-administration (HQ) och kan påverka prestanda negativt.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-200">Frequent runs will overload Commerce headquarters (HQ) and can potentially impact performance.</span></span> <span data-ttu-id="0bdc4-201">I allmänhet är det bra att köra produkttillgänglighet och 1130 jobb per timme och att tidsplanera P-jobb, synkronisera order och indroppningsbaserade jobb med samma eller högre frekvens.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-201">In general, it's good practice to run product availability and 1130 jobs on an hourly basis, and schedule P-job, synchronize orders, and trickle feed posting-related jobs with the same or higher frequency.</span></span>

> [!NOTE]
> <span data-ttu-id="0bdc4-202">Av prestandaskäl används beräkningen av lagerdispositionen för lagertillgänglighetsberäkningar för att göra en begäran om lagertillgänglighet att använda näthandels API: n eller den nya lagerlogiken för kassakanaler, beräkningen använder cache som fastställer om det har gått tillräckligt med tid för att motivera körning av beräkningslogiken igen.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-202">For performance reasons, when channel-side inventory availability calculations are used to make an inventory availability request using the e-Commerce API's or the new POS channel-side inventory logic, the calculation uses a cache to determine whether enough time has passed to justify running the calculation logic again.</span></span> <span data-ttu-id="0bdc4-203">Standardcache är inställd på 60 sekunder.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-203">The default cache is set to 60 seconds.</span></span> <span data-ttu-id="0bdc4-204">Du har till exempel aktiverat en beräkning på kanalsidan för butiken och visat lagerbehållningen för en produkt på sidan **lagersökning**.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-204">For example, you turned on channel-side calculation for your store and viewed the on-hand inventory for a product on the **Inventory lookup** page.</span></span> <span data-ttu-id="0bdc4-205">Om en enhet av produkten sedan säljs kommer sidan **lagersökning** inte att visa det reducerade lagret förrän cachen har rensats.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-205">If one unit of the product is then sold, the **Inventory lookup** page won't show the reduced inventory until the cache has been cleared.</span></span> <span data-ttu-id="0bdc4-206">När användarna har bokfört transaktioner i POS ska de vänta 60 sekunder innan de kontrollerar att lagerbehållningen har reducerats.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-206">After users post transactions in POS, they should wait 60 seconds before they verify that the on-hand inventory has been reduced.</span></span>

<span data-ttu-id="0bdc4-207">Om det krävs en mindre cachetid för affärsscenariot kan du kontakta produktsupporten för att få hjälp.</span><span class="sxs-lookup"><span data-stu-id="0bdc4-207">If your business scenario requires a smaller cache time, contact your product support representative for help.</span></span>


[!INCLUDE[footer-include](../includes/footer-banner.md)]