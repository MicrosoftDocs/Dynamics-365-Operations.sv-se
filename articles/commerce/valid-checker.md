---
title: Konsekvenskontroll av butikstransaktion
description: Det här ämnet beskriver funktionen för konsekvenskontroll av transaktioner i Dynamics 365 Commerce.
author: josaw1
manager: AnnBe
ms.date: 10/07/2020
ms.topic: index-page
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.custom: ''
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: josaw
ms.search.validFrom: 2019-01-15
ms.dyn365.ops.version: 10
ms.openlocfilehash: cce0d408ac6d372fb726eff8fa4b0358ec200243
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 02/15/2021
ms.locfileid: "5211005"
---
# <a name="retail-transaction-consistency-checker"></a><span data-ttu-id="0a9d6-103">Konsekvenskontroll av butikstransaktion</span><span class="sxs-lookup"><span data-stu-id="0a9d6-103">Retail transaction consistency checker</span></span>

[!include [banner](includes/banner.md)]

<span data-ttu-id="0a9d6-104">Det här ämnet beskriver funktionen för konsekvenskontroll av transaktioner i Microsoft Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-104">This topic describes the transaction consistency checker functionality in Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="0a9d6-105">Konsekvenskontrollen identifierar och isolerar inkonsekventa transaktioner innan de används i bokföringsprocessen för utdrag.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-105">The consistency checker identifies and isolates inconsistent transactions before they are picked up by the statement posting process.</span></span>

<span data-ttu-id="0a9d6-106">Det går inte att bokföra utdrag om det finns inkonsekventa data i handelstransaktionsregistren.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-106">When a statement is posted, posting can fail due to inconsistent data in the commerce transaction tables.</span></span> <span data-ttu-id="0a9d6-107">Dataproblemet kan bero på oförutsedda problem i kassaprogrammet, eller om transaktioner har importerats felaktigt från kassasystem från tredje part.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-107">The data issue may be caused by unforeseen issues in the point of sale (POS) application, or if transactions were incorrectly imported from third-party POS systems.</span></span> <span data-ttu-id="0a9d6-108">Dessa inkonsekvenser kan till exempel uppenbara sig på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="0a9d6-108">Examples of how these inconsistencies may appear include:</span></span> 

- <span data-ttu-id="0a9d6-109">Transaktionssumman i huvudtabellen stämmer inte överens med transaktionssumman på raderna.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-109">The transaction total on the header table does not match the transaction total on the lines.</span></span>
- <span data-ttu-id="0a9d6-110">Radantalet i huvudtabellen stämmer inte överens med antalet rader i transaktionstabellen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-110">The line count on the header table does not match with the number of lines in the transaction table.</span></span>
- <span data-ttu-id="0a9d6-111">Momsen i huvudtabellen stämmer inte överens med momsbeloppet på raderna.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-111">Taxes on the header table do not match the tax amount on the lines.</span></span> 

<span data-ttu-id="0a9d6-112">När inkonsekventa transaktioner fångas upp i bokföringsprocessen för utdrag, skapas inkonsekventa försäljningsfakturor och betalningsjournaler, och bokföringsprocessen för utdrag går inte att utföra.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-112">When inconsistent transactions are picked up by the statement posting process, inconsistent sales invoices and payment journals are created, and the entire statement posting process fails as a result.</span></span> <span data-ttu-id="0a9d6-113">När utdragen ska återställas från ett sådant tillstånd krävs komplexa datakorrigeringar av flera transaktionsregister.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-113">Recovering the statements from such a state involves complex data fixes across multiple transaction tables.</span></span> <span data-ttu-id="0a9d6-114">Konsekvenskontrollen av transaktioner förhindrar sådana problem.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-114">The transaction consistency checker prevents such issues.</span></span>

<span data-ttu-id="0a9d6-115">I följande diagram visas bokföringsprocessen där konsekvenskontroll av transaktioner tillämpas.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-115">The following chart illustrates the posting process with the transaction consistency checker.</span></span>

<span data-ttu-id="0a9d6-116">![Bokföringsprocess för utdrag med konsekvenskontroll av transaktioner](./media/validchecker.png "Bokföringsprocess för utdrag med konsekvenskontroll av butikstransaktioner")</span><span class="sxs-lookup"><span data-stu-id="0a9d6-116">![Statement posting process with transaction consistency checker](./media/validchecker.png "Statement posting process with retail transaction consistency checker")</span></span>

<span data-ttu-id="0a9d6-117">Batchprocessen **Validera butikstransaktioner** kontrollerar att butikens handelstransaktionsregister är konsekventa i följande scenarier.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-117">The **Validate store transactions** batch process checks the consistency of the commerce transaction tables for the following scenarios.</span></span>

- <span data-ttu-id="0a9d6-118">**Kundkonto** – Validerar att kundkontot i transaktionsregistren finns i huvudkontorets kundmall.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-118">**Customer account** – Validates that the customer account in the transaction tables exists in the HQ customer master.</span></span>
- <span data-ttu-id="0a9d6-119">**Radräkning** – Validerar att antalet rader, som anges i transaktionshuvudregistret, motsvarar antalet rader i försäljningstransaktionsregistren.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-119">**Line count** – Validates that the number of lines, as captured on the transaction header table, matches the number of lines in the sales transaction tables.</span></span>
- <span data-ttu-id="0a9d6-120">**Pris inklusive moms** – Validerar att parametern **Pris inklusive moms** är konsekvent på alla transaktionsrader och att priset på försäljningsraden är förenligt med konfigurationen av pris inklusive moms och momsbefrielse.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-120">**Price includes tax** – Validates that the **Price includes tax** parameter is consistent across transaction lines and the price on the sales line is in accordance with price includes tax and tax exempt configuration.</span></span>
- <span data-ttu-id="0a9d6-121">**Betalningsbelopp** – Validerar att betalningsposterna stämmer överens med betalningsbeloppet i huvudet, men tar även hänsyn till konfigurationen för öresavrundning i redovisningen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-121">**Payment amount** - Validates that the payment records match the payment amount on the header, while also factoring in the configuration for penny rounding in General Ledger.</span></span>
- <span data-ttu-id="0a9d6-122">**Bruttobelopp** – Validerar att bruttobeloppet i huvudet är summan av nettobeloppen på raderna plus momsbeloppet, men tar också hänsyn till konfigurationen för öresavrundning i redovisningen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-122">**Gross amount** – Validates that the gross amount on the header is the sum of the net amounts on the lines plus the tax amount, while also factoring in the configuration for penny rounding in General Ledger.</span></span>
- <span data-ttu-id="0a9d6-123">**Nettobelopp** – Validerar att nettobeloppet i huvudet är summan av nettobeloppen på raderna, men tar också hänsyn till konfigurationen för öresavrundning i redovisningen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-123">**Net amount** – Validates that the net amount on the header is the sum of the net amounts on the lines, while also factoring in the configuration for penny rounding in General Ledger.</span></span>
- <span data-ttu-id="0a9d6-124">**Under-/överbetalning** – Validerar att skillnaden mellan bruttobeloppet i huvudet och betalningsbeloppet inte överskrider den maximala konfigurationen av underbetalning/överbetalning, men tar också hänsyn till konfigurationen för öresavrundning i redovisningen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-124">**Under / Over payment** – Validates that the difference between the gross amount on the header and the payment amount doesn't exceed the maximum underpayment/overpayment configuration, while also factoring in the configuration for penny rounding in General Ledger.</span></span>
- <span data-ttu-id="0a9d6-125">**Rabattbelopp** – Validerar att rabattbeloppet för rabattregistren och rabattbeloppet i registren för butikstransaktionsrader är konsekventa och att rabattbeloppet i huvudet är lika med summan av rabattbeloppen på raderna, men tar också hänsyn till konfigurationen för öresavrundning i redovisningen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-125">**Discount amount** – Validates that the discount amount on the discount tables and the discount amount on the transaction line tables are consistent, and that the discount amount on the header is the sum of the discount amounts on the lines, while also factoring in the configuration for penny rounding in General Ledger.</span></span>
- <span data-ttu-id="0a9d6-126">**Radrabatt** – Validerar att radrabatten på transaktionsraden är lika med summan av alla rader i rabattregistren som motsvarar transaktionsraden.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-126">**Line discount** – Validates that the line discount on the transaction line is the sum of all the lines in the discount table that corresponds to the transaction line.</span></span>
- <span data-ttu-id="0a9d6-127">**Presentkortsartikel** – Det går inte att returnera presentkortsartiklar i Commerce.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-127">**Gift card item** – Commerce doesn't support the return of gift card items.</span></span> <span data-ttu-id="0a9d6-128">Saldot på ett presentkort kan dock betalas ut kontant. En presentkortsartikel som bearbetas som en returrad i stället för en utbetalningsrad gör att utdragsbokföringsprocessen misslyckas.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-128">However, the balance on a gift card can be cashed out. Any gift card item that is processed as a return line instead of a cash-out line fails the statement posting process.</span></span> <span data-ttu-id="0a9d6-129">Valideringsprocessen för presentkortsartiklar garanterar att de enda returraderna för presentkortsartiklar i transaktionsregistren utgörs av rader för kontantutbetalning av presentkort.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-129">The validation process for gift card items helps guarantee that the only return gift card line items on the transaction tables are gift card cash-out lines.</span></span>
- <span data-ttu-id="0a9d6-130">**Negativt pris** – Validerar att det inte finns några negativa pristransaktionsrader.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-130">**Negative price** – Validates that there are no negative price transaction lines.</span></span>
- <span data-ttu-id="0a9d6-131">**Artikel och variant** – Validerar att artiklar och varianter på transaktionsraderna finns i artikel- och varianthuvudfilen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-131">**Item & Variant** – Validates that items and variants on the transaction lines exist in the item and variant master file.</span></span>
- <span data-ttu-id="0a9d6-132">**Momsbelopp** – Validerar att skatteposterna stämmer med skattebeloppen på raderna.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-132">**Tax amount** - Validates that tax records match the tax amounts on the lines.</span></span>
- <span data-ttu-id="0a9d6-133">**Serienummer** – Validerar att serienumret finns på transaktionsraderna för artiklar som kontrolleras med serienummer.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-133">**Serial number** - Validates that the serial number is present in the transaction lines for items that are controlled by serial number.</span></span>
- <span data-ttu-id="0a9d6-134">**Förtecken** – Validerar att förtecknet på kvantiteten och nettobeloppet är detsamma i alla transaktionsrader.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-134">**Sign** - Validates that the sign on the quantity and the net amount are the same in all the transaction lines.</span></span>
- <span data-ttu-id="0a9d6-135">**Affärsdatum** – Validerar att de finansiella perioderna för alla affärsdatum för transaktionerna är öppna.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-135">**Business date** - Validates that the financial periods for all the business dates for the transactions are open.</span></span>
- <span data-ttu-id="0a9d6-136">**Avgifter** – Validerar att avgiftsbeloppen i huvudet och på raderna överensstämmer med konfigurationen av pris, inklusive moms och momsbefrielse.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-136">**Charges** - Validates that the header and line charge amount is in accordance with price, including tax and tax exempt configuration.</span></span>

## <a name="set-up-the-consistency-checker"></a><span data-ttu-id="0a9d6-137">Ställa in konsekvenskontrollen</span><span class="sxs-lookup"><span data-stu-id="0a9d6-137">Set up the consistency checker</span></span>

<span data-ttu-id="0a9d6-138">Konfigurera batchprocessen "Validera butikstransaktioner" i **Retail och Commerce \> Retail och Commerce IT \> Kassabokföring** för periodiska körningar.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-138">Configure the "Validate store transactions" batch process, at **Retail and Commerce \> Retail and Commerce IT \> POS posting**, for periodic runs.</span></span> <span data-ttu-id="0a9d6-139">Batchjobbet kan schemaläggas utifrån butikens organisationshierarki, vilket påminner om hur processerna "Beräkna utdrag i batch" och "Bokför utdrag i batch" konfigureras.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-139">The batch job can be scheduled based on store organization hierarchy, similar to how the "Calculate statement in batch" and "Post statement in batch" processes are set up.</span></span> <span data-ttu-id="0a9d6-140">Vi rekommenderar att du konfigurerar den här batchprocessen så att den körs flera gånger under en dag och schemalägga den så att den körs i slutet av varje P-jobbskörning.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-140">We recommend that you configure this batch process to run multiple times in a day and schedule it so that it runs at the end of every P-job execution.</span></span>

## <a name="results-of-validation-process"></a><span data-ttu-id="0a9d6-141">Resultat av valideringsprocessen</span><span class="sxs-lookup"><span data-stu-id="0a9d6-141">Results of validation process</span></span>

<span data-ttu-id="0a9d6-142">Resultaten av batchprocessens valideringskontroll märks i motsvarande transaktion.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-142">The results of the validation check by the batch process are tagged on the appropriate transaction.</span></span> <span data-ttu-id="0a9d6-143">Fältet **Valideringsstatus** i transaktionsposten anges antingen till **Slutförd** eller **Fel**, och datumet för den senaste valideringskörningen visas i fältet **Senaste valideringstid**.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-143">The **Validation status** field on the transaction record is either set to **Successful** or **Error**, and the date of the last validation run appears on the **Last validation time** field.</span></span>

<span data-ttu-id="0a9d6-144">Om du vill visa en mer beskrivande feltext som berör ett valideringsfel markerar du aktuell butikstransaktionspost och klickar på **Valideringsfel**.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-144">To view more descriptive error text relating to a validation failure, select the relevant store transaction record and click the **Validation errors** button.</span></span>

<span data-ttu-id="0a9d6-145">Transaktionerna som inte klarar valideringskontrollen och de transaktioner som ännu inte validerats används inte i utdragen.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-145">Transactions that fail the validation check and transactions that have not yet been validated will not be pulled into statements.</span></span> <span data-ttu-id="0a9d6-146">Under processen "Beräkna utdrag" meddelas användarna om det finns transaktioner som kan ha inkluderats i uttrycket men inte som inte har det.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-146">During the "Calculate statement" process, users will be notified if there are transactions that could have been included in the statement but weren't.</span></span>

<span data-ttu-id="0a9d6-147">Om ett valideringsfel inträffar går det bara att korrigera felet genom att kontakta Microsoft Support.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-147">If a validation error is found, the only way to fix the error is to contact Microsoft Support.</span></span> <span data-ttu-id="0a9d6-148">I en framtida version kommer en funktion att läggas till som gör att användarna kan korrigera posterna via användargränssnittet.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-148">In a future release, capability will be added so that users can fix the records that failed through the user interface.</span></span> <span data-ttu-id="0a9d6-149">Funktioner för loggning och granskning kommer också att införas, vilka gör det möjligt att spåra ändringshistoriken.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-149">Logging and auditing capabilities will also be made available to trace the history of the modifications.</span></span>

> [!NOTE]
> <span data-ttu-id="0a9d6-150">Ytterligare valideringsregler för andra scenarier kommer i framtida versioner.</span><span class="sxs-lookup"><span data-stu-id="0a9d6-150">Additional validation rules to support more scenarios will be added in a future release.</span></span>


[!INCLUDE[footer-include](../includes/footer-banner.md)]